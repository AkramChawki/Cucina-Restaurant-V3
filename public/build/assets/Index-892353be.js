import{j as t,r as g,W as j,a,F as R}from"./app-cf5133c4.js";import{c as m}from"./createLucideIcon-02e80c65.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],F=m("Calendar",P);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],T=m("Camera",L);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],f=m("ChevronDown",E);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],z=m("Clock",M),H=(r,i)=>{if(!r||!i)return"";const h=new Date(`${r}T${i}`),c=new Date(h.getTime()+60*60*1e3),p=c.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),u=c.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${p} ${u}`},q=({dateStr:r,timeStr:i})=>t("span",{className:"whitespace-nowrap",children:H(r,i)}),O=q;function U({employes:r,restaurants:i,postes:h,infractions:c}){var v,N,w;const[p,u]=g.useState(null),y=g.useRef(null),[x,b]=g.useState(!1),{data:n,setData:o,post:_,processing:k,errors:V,reset:C}=j({restaurant:"",infraction_constatee:"",poste:"",employe_id:"",photo:null,infraction_date:"",infraction_time:""}),D=e=>{e.preventDefault(),_(route("infractions.store"),{onSuccess:()=>{C(),u(null)},preserveScroll:!0})},$=async e=>{e.preventDefault();const l=e.target;if(!l.date_from.value||!l.date_to.value){alert("Veuillez sélectionner les dates de début et de fin");return}const s=l.date_from.value,d=l.date_to.value;if(s>d){alert("La date de début doit être antérieure à la date de fin");return}const I=`${route("infractions.report")}?date_from=${s}&date_to=${d}`;window.open(I,"_blank")},S=e=>{const l=e.target.files[0];if(l){o("photo",l);const s=new FileReader;s.onloadend=()=>{u(s.result)},s.readAsDataURL(l)}};return a("div",{className:"max-w-3xl mx-auto px-2 sm:px-4 py-4 sm:py-8",children:[t("h1",{className:"text-2xl font-semibold text-gray-900 mb-8",children:"Nouvelle Infraction"}),a("form",{onSubmit:D,className:"space-y-6",children:[a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Restaurant"}),a("div",{className:"relative",children:[a("select",{value:n.restaurant,onChange:e=>o("restaurant",e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",children:[t("option",{value:"",children:"Sélectionner un restaurant"}),i.map(e=>t("option",{value:e,children:e},e))]}),t(f,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"})]})]}),a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Poste"}),a("div",{className:"relative",children:[a("select",{value:n.poste,onChange:e=>o("poste",e.target.value),className:"w-full appearance-none rounded-lg border border-gray-300 px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",children:[t("option",{value:"",children:"Sélectionner un poste"}),h.map(e=>t("option",{value:e,children:e},e))]}),t(f,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"})]})]}),a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Employé"}),a("div",{className:"relative",children:[a("button",{type:"button",onClick:()=>b(!x),className:"w-full text-left rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white flex items-center justify-between",children:[a("div",{className:"flex items-center",children:[n.employe_id&&r&&a(R,{children:[((v=r.find(e=>e.id===parseInt(n.employe_id)))==null?void 0:v.profile_photo)&&t("img",{src:`https://restaurant.cucinanapoli.com/public/storage/${r.find(e=>e.id===parseInt(n.employe_id)).profile_photo}`,alt:"",className:"h-8 w-8 rounded-full mr-3 object-cover"}),a("span",{children:[(N=r.find(e=>e.id===parseInt(n.employe_id)))==null?void 0:N.first_name," "," ",(w=r.find(e=>e.id===parseInt(n.employe_id)))==null?void 0:w.last_name]})]}),!n.employe_id&&t("span",{children:"Sélectionner un employé"})]}),t(f,{className:"h-5 w-5 text-gray-400"})]}),x&&t("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-lg max-h-60 overflow-auto",children:r.map(e=>a("div",{className:"px-4 py-2 hover:bg-gray-50 cursor-pointer flex items-center",onClick:()=>{o("employe_id",e.id),b(!1)},children:[e.profile_photo&&t("img",{src:`https://restaurant.cucinanapoli.com/public/storage/${e.profile_photo}`,alt:"",className:"h-8 w-8 rounded-full mr-3 object-cover"}),a("span",{children:[e.first_name," ",e.last_name]})]},e.id))})]})]}),a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Infraction constatée"}),t("textarea",{value:n.infraction_constatee,onChange:e=>o("infraction_constatee",e.target.value),rows:4,className:"w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Date"}),a("div",{className:"relative",children:[t("input",{type:"date",value:n.infraction_date,onChange:e=>o("infraction_date",e.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-purple-500"}),t(F,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"})]})]}),a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Heure"}),a("div",{className:"relative",children:[t("input",{type:"time",value:n.infraction_time,onChange:e=>o("infraction_time",e.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-purple-500"}),t(z,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"})]})]})]}),a("div",{children:[t("label",{className:"block text-base text-gray-700 mb-2",children:"Photo"}),t("input",{type:"file",ref:y,className:"hidden",onChange:S,accept:"image/*",capture:"environment"}),a("button",{type:"button",onClick:()=>{var e;return(e=y.current)==null?void 0:e.click()},className:"flex items-center space-x-2 rounded-lg border border-gray-300 px-4 py-3 text-gray-700 hover:bg-gray-50",children:[t(T,{className:"h-5 w-5"}),t("span",{children:"Prendre une photo"})]}),p&&t("div",{className:"mt-2",children:t("img",{src:p,alt:"Preview",className:"h-32 w-32 object-cover rounded-lg"})})]}),t("div",{className:"flex justify-center",children:t("button",{type:"submit",disabled:k,className:"px-4 sm:px-6 py-2 sm:py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2",children:"Enregistrer"})})]}),a("div",{className:"mt-12",children:[a("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[t("h2",{className:"text-xl font-semibold text-gray-900",children:"Liste des infractions"}),a("form",{onSubmit:$,className:"flex flex-col sm:flex-row gap-2 sm:items-center sm:space-x-4",children:[t("input",{type:"date",name:"date_from",className:"rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"}),t("input",{type:"date",name:"date_to",className:"rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"}),t("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:"Générer Rapport"})]})]}),t("div",{className:"bg-white rounded-lg shadow",children:t("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:t("div",{className:"inline-block min-w-full align-middle",children:a("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:a("tr",{children:[t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Restaurant"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Poste"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employé"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Infraction"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date/Heure"})]})}),t("tbody",{className:"bg-white divide-y divide-gray-200",children:c&&c.map(e=>{var l,s,d;return a("tr",{children:[t("td",{className:"px-6 py-4 whitespace-nowrap",children:e.restaurant}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:e.poste}),t("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center",children:[((l=e.employe)==null?void 0:l.profile_photo)&&t("img",{src:`https://restaurant.cucinanapoli.com/public/storage/${e.employe.profile_photo}`,alt:"",className:"h-8 w-8 rounded-full mr-2"}),a("span",{children:[(s=e.employe)==null?void 0:s.first_name," ",(d=e.employe)==null?void 0:d.last_name]})]})}),t("td",{className:"px-6 py-4",children:e.infraction_constatee}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:t(O,{dateStr:e.infraction_date,timeStr:e.infraction_time})})]},e.id)})})]})})})})]})]})}export{U as default};
