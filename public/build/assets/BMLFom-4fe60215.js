import{j as s,R as ie,r as p,a as i,f as O}from"./app-5e0ddc55.js";import{c as T}from"./createLucideIcon-e229967a.js";import{C as oe}from"./calendar-194e21d7.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],ce=T("ChevronsUpDown",le);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ue=T("CircleAlert",de);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],me=T("CircleCheckBig",ge);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],pe=T("CirclePlus",he);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ye=T("Save",fe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],xe=T("Trash2",be);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ne=T("X",ve),we=({message:d,type:u="success",onClose:l})=>(p.useEffect(()=>{const k=setTimeout(()=>{l()},3e3);return()=>clearTimeout(k)},[l]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${u==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[s("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:u==="success"?s(me,{className:"w-5 h-5 text-green-600"}):s(ue,{className:"w-5 h-5 text-red-600"})}),s("div",{className:"ml-3 text-sm font-normal",children:d}),s("button",{onClick:l,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:s(Ne,{className:"w-5 h-5"})})]})),Ce=({toasts:d,removeToast:u})=>s("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:d.map(l=>s(we,{message:l.message,type:l.type,onClose:()=>u(l.id)},l.id))}),De=()=>{const[d,u]=ie.useState([]);return{toasts:d,addToast:(N,w="success")=>{const c=Date.now();u(_=>[..._,{id:c,message:N,type:w}])},removeToast:N=>{u(w=>w.filter(c=>c.id!==N))}}},I={gastro:["Mozzarella Milka","Creme Fraîche","PERLA CERISE","Mozzarella cerise"],giada:["Mozzarella","Stracciatella","Buratta","Ricotta"],legume:["Roquette","EPINARD","Tomate cerise","Poivron Rouge","Poivron vert","CHAMPIGNON","CITRON","ORANGUE","CONCOMBRE","AIL","Basilic","Courgette","OIGNON"],boisson:["Coca","Coca Zero","Hawaei","Sprite","POMS","Citron","Tonic"]},ke=["Kg","KG","250G","unite","L","Botte","BROT","paquet de 24 U","Pot de 1 kg"],$=d=>{if(!d)return"";try{const u=d instanceof Date?d:new Date(d),l=u.getTimezoneOffset()*6e4;return new Date(u.getTime()-l).toISOString().split("T")[0]}catch(u){return console.error("Error formatting date:",u),""}},B=d=>{switch(d){case"gastro":return"GASTRO";case"giada":return"GIADA";case"legume":return"Legume";case"boisson":return"COCA COLA";default:return""}},Se=({value:d,onChange:u,disabled:l})=>{const[k,N]=p.useState(!1),w=p.useRef(null),c=new Date(d);p.useEffect(()=>{const o=g=>{w.current&&!w.current.contains(g.target)&&N(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[w]);const _=new Date().getFullYear(),C=Array.from({length:6},(o,g)=>_-g),A=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],h=o=>{const g=new Date(c.getFullYear(),o);u(g),N(!1)},q=o=>{const g=new Date(o,c.getMonth());u(g),N(!1)};return i("div",{className:"relative",ref:w,children:[i("button",{type:"button",onClick:()=>!l&&N(!k),className:`flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm ${l?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,disabled:l,children:[s(oe,{className:"w-4 h-4 mr-2 text-gray-500"}),i("span",{children:[A[c.getMonth()]," ",c.getFullYear()]}),s(ce,{className:"w-4 h-4 ml-2 text-gray-500"})]}),k&&i("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-2 w-64",children:[i("div",{className:"mb-2",children:[s("div",{className:"font-medium text-gray-700 mb-1",children:"Mois"}),s("div",{className:"grid grid-cols-3 gap-1",children:A.map((o,g)=>s("button",{type:"button",className:`text-sm p-1 rounded ${c.getMonth()===g?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>h(g),children:o.substring(0,3)},o))})]}),i("div",{children:[s("div",{className:"font-medium text-gray-700 mb-1",children:"Année"}),s("div",{className:"grid grid-cols-3 gap-1",children:C.map(o=>s("button",{type:"button",className:`text-sm p-1 rounded ${c.getFullYear()===o?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>q(o),children:o},o))})]})]})]})};function Re({restaurant:d,currentMonth:u,existingEntries:l=[],types:k={},currentType:N=""}){const{toasts:w,addToast:c,removeToast:_}=De(),[C,A]=p.useState(new Date(u.year,u.month-1)),[h,q]=p.useState(N),[o,g]=p.useState(!1),[S,D]=p.useState({}),j=p.useRef(!0),P=p.useRef(l),[Q,Y]=p.useState(null),[f,W]=p.useState({key:"date",direction:"ascending"}),L=()=>({id:Date.now()+Math.floor(Math.random()*1e3),fournisseur:B(h),designation:"",quantity:"",price:"",unite:"",date:$(new Date),type:h,total_ttc:0,isNew:!0,isSaving:!1,hasChanges:!1}),[v,y]=p.useState([L()]),E=v.some(e=>e.hasChanges),V=(e,a,r)=>{if(e){if(r===0){y(t=>t.filter(n=>!(n.date===e&&n.type===a)));return}y(t=>[...t])}},Z=e=>e.reduce((r,t)=>{const n=t.date;return n&&(r[n]||(r[n]={rows:[],total:0}),r[n].rows.push(t),r[n].total+=parseFloat(t.total_ttc)||0),r},{});p.useEffect(()=>{if(j.current){j.current=!1;return}const e=JSON.stringify(P.current)!==JSON.stringify(l);if(P.current=l,!!e)if(l&&l.length>0){const a=l.map((r,t)=>({id:Date.now()+t,fournisseur:r.fournisseur||B(r.type),designation:r.designation||"",quantity:r.quantity||"",price:r.price||"",unite:r.unite||"",date:$(r.date),type:r.type||h,total_ttc:parseFloat(r.total_ttc)||0,isNew:!1,isSaving:!1,hasChanges:!1,originalId:r.id}));y(a)}else y([L()])},[l]);const ee=[...v].sort((e,a)=>{if(!e[f.key]||!a[f.key])return 0;if(f.key==="date"){const n=new Date(e.date),m=new Date(a.date);return f.direction==="ascending"?n-m:m-n}const r=e[f.key].toString().toLowerCase(),t=a[f.key].toString().toLowerCase();return r<t?f.direction==="ascending"?-1:1:r>t?f.direction==="ascending"?1:-1:0}),K=e=>{let a="ascending";f.key===e&&f.direction==="ascending"&&(a="descending"),W({key:e,direction:a})},G=e=>f.key!==e?null:s("span",{className:"ml-1",children:f.direction==="ascending"?"▲":"▼"}),U=(e,a)=>{const r=parseFloat(e)||0,t=parseFloat(a)||0;return(r*t).toFixed(2)},F=e=>{if(!e)return!1;const a=new Date(e);return a.getMonth()+1!==C.getMonth()+1||a.getFullYear()!==C.getFullYear()},H=()=>{y(e=>[...e,L()])},te=async e=>{const a=v.find(r=>r.id===e);if(a){if(v.length<=1){c("Impossible de supprimer la seule ligne","warning");return}if(!a.isNew&&a.originalId){if(!confirm("Êtes-vous sûr de vouloir supprimer cette ligne?"))return;D(r=>({...r,[e]:!0}));try{await O.post(route("bml.delete"),{id:a.originalId,restaurant_id:d.id},{onSuccess:r=>{c("Ligne supprimée avec succès","success"),y(t=>t.filter(n=>n.id!==e)),D(t=>{const n={...t};return delete n[e],n}),r.day_total&&V(r.day_total.date,r.day_total.type,r.day_total.total)},onError:r=>{console.error("Delete error:",r),c("Erreur lors de la suppression","error"),D(t=>({...t,[e]:!1}))}})}catch(r){c("Erreur lors de la suppression","error"),console.error("Error deleting row:",r),D(t=>({...t,[e]:!1}))}}else y(r=>r.filter(t=>t.id!==e)),D(r=>{const t={...r};return delete t[e],t})}},M=(e,a,r)=>{y(t=>t.map(n=>{if(n.id===e){const m={...n,[a]:r,hasChanges:!0};return a==="type"&&(m.fournisseur=B(r)),(a==="quantity"||a==="price")&&(m.total_ttc=U(a==="quantity"?r:n.quantity,a==="price"?r:n.price)),m}return n}))},re=e=>{try{const a=e.target.value;if(console.log("Type changed to:",a),E&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;q(a),g(!0);const r=a===""?null:a,t=route("bml.show",[d.slug]);console.log("Navigating to:",t,"with type:",r),O.get(t,{month:C.getMonth()+1,year:C.getFullYear(),type:r},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{console.log("Navigation successful",n),g(!1)},onError:n=>{console.error("Navigation error:",n),g(!1),c("Erreur lors du chargement des données.","error")}})}catch(a){console.error("Error in handleTypeChange:",a),g(!1),c("Une erreur est survenue lors du changement de type.","error")}},ae=e=>{E&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?")||(A(e),g(!0),O.get(route("bml.show",[d.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:h},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{g(!1)},onError:()=>{g(!1),c("Erreur lors du chargement des données.","error")}}))},J=()=>{const e=Z(v);return Object.entries(e).map(([a,r])=>({date:a,total:r.total.toFixed(2)})).sort((a,r)=>a.date.localeCompare(r.date))},z=async e=>{const a=v.find(r=>r.id===e);if(a){if(!a.date||!a.fournisseur||!a.designation||!a.quantity||!a.price||!a.unite){c("Veuillez remplir tous les champs obligatoires.","error");return}if(F(a.date)){const t=new Date(a.date).toLocaleDateString("fr-FR");if(!confirm(`Attention: La date sélectionnée (${t}) est en dehors du mois actuel. Cette entrée sera automatiquement placée dans le mois correspondant à sa date. Voulez-vous continuer?`))return}y(r=>r.map(t=>t.id===e?{...t,isSaving:!0}:t)),D(r=>({...r,[e]:!0}));try{const r=new Date(a.date),t={...a,date:$(r),type:h||a.type||"gastro",total_ttc:U(a.quantity,a.price)},n={restaurant_id:d.id,rows:[t],month:r.getMonth()+1,year:r.getFullYear(),type:h||"gastro",day_total:parseFloat(t.total_ttc).toFixed(2)};await O.post(route("bml.update-value"),n,{preserveState:!0,onSuccess:m=>{c("Ligne enregistrée avec succès","success"),y(b=>b.map(x=>x.id===e?{...x,isSaving:!1,hasChanges:!1,isNew:!1,originalId:x.isNew&&m.created_id?m.created_id:x.originalId}:x)),D(b=>({...b,[e]:!1})),m.day_totals&&m.day_totals.length>0&&m.day_totals.forEach(b=>{V(b.date,b.type,b.total)}),F(a.date)&&O.get(route("bml.show",[d.slug]),{month:C.getMonth()+1,year:C.getFullYear(),type:h===""?null:h},{preserveScroll:!0,preserveState:!0})},onError:m=>{console.error("Save error:",m),c("Erreur lors de l'enregistrement","error"),y(b=>b.map(x=>x.id===e?{...x,isSaving:!1}:x)),D(b=>({...b,[e]:!1}))}})}catch(r){console.error("Error saving row:",r),c("Erreur lors de l'enregistrement","error"),y(t=>t.map(n=>n.id===e?{...n,isSaving:!1}:n)),D(t=>({...t,[e]:!1}))}}},se=e=>{e.preventDefault();const a=v.filter(r=>r.hasChanges);if(a.length===0){c("Aucune modification à enregistrer.","info");return}if(confirm(`Voulez-vous enregistrer ${a.length} ligne(s) modifiée(s)?`))for(const r of a)z(r.id)},R=(e,a,r,t)=>{if(e.key==="Enter"){e.preventDefault(),z(a);return}if(e.key==="Tab"&&!e.shiftKey){const n=["date","fournisseur","designation","quantity","unite","price"];n.indexOf(r)===n.length-1&&(e.preventDefault(),t===v.length-1&&H(),setTimeout(()=>{const x=t+1;if(x<v.length){const ne=v[x].id,X=document.querySelector(`input[name="date-${ne}"]`);X&&X.focus()}},0))}};return i("div",{className:"p-4 sm:p-6",children:[s("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[s("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[d.name," -"," ",C.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),s("div",{className:"relative",children:i("select",{value:h,onChange:re,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 py-2 pl-3 pr-10 text-base",disabled:o,children:[s("option",{value:"",children:"Tous les types"}),Object.entries(k).map(([e,a])=>s("option",{value:a,children:e},a))]})})]}),s("div",{className:"flex-shrink-0",children:s(Se,{value:C,onChange:ae,disabled:o})})]})}),s("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:i("form",{onSubmit:se,children:[o&&s("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i("div",{className:"text-center",children:[s("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),s("p",{className:"mt-2 text-gray-600",children:"Chargement en cours..."})]})}),s("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[s("thead",{className:"bg-gray-50",children:i("tr",{children:[s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("date"),children:i("div",{className:"flex items-center",children:["Date ",G("date")]})}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Fournisseur"}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("designation"),children:i("div",{className:"flex items-center",children:["Designation"," ",G("designation")]})}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Quantité"}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Unité"}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Prix"}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Total TTC"}),s("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Actions"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[ee.map((e,a)=>{var r;return i("tr",{className:`hover:bg-gray-50 transition-colors duration-150 ${e.hasChanges?"bg-blue-50":""}`,children:[i("td",{className:`px-4 py-2 ${F(e.date)?"bg-yellow-50":""}`,children:[i("div",{className:"relative",children:[s("input",{name:`date-${e.id}`,type:"date",value:e.date||"",onChange:t=>M(e.id,"date",t.target.value),onKeyDown:t=>R(t,e.id,"date",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${F(e.date)?"border-yellow-400 bg-yellow-50":""} ${e.hasChanges?"border-blue-300":""}`,required:!0,disabled:o||S[e.id],max:$(new Date)}),F(e.date)&&s("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:s("svg",{className:"h-5 w-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:s("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),F(e.date)&&s("div",{className:"text-xs text-yellow-600 mt-1",children:"Date hors du mois sélectionné"})]}),s("td",{className:"px-4 py-2",children:s("input",{type:"text",value:e.fournisseur,onChange:t=>M(e.id,"fournisseur",t.target.value),onKeyDown:t=>R(t,e.id,"fournisseur",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""}`,required:!0,disabled:!0})}),i("td",{className:"px-4 py-2 relative",children:[s("input",{id:`designation-${e.id}`,type:"text",value:e.designation,onChange:t=>M(e.id,"designation",t.target.value),onKeyDown:t=>R(t,e.id,"designation",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""}`,required:!0,disabled:o||S[e.id],autoComplete:"off",onFocus:()=>Y(e.id),onBlur:()=>{setTimeout(()=>Y(null),200)}}),!o&&Q===e.id&&i("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-md z-50 max-h-40 overflow-y-auto",children:[(r=I[h])==null?void 0:r.map((t,n)=>s("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onMouseDown:m=>{m.preventDefault(),M(e.id,"designation",t)},children:t},n)),(!I[h]||I[h].length===0)&&s("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Aucune suggestion"})]})]}),s("td",{className:"px-4 py-2",children:s("input",{type:"number",value:e.quantity,onChange:t=>M(e.id,"quantity",t.target.value),onKeyDown:t=>R(t,e.id,"quantity",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""}`,min:"0",step:"0.01",required:!0,disabled:o||S[e.id]})}),s("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[s("input",{type:"text",list:"unite-options",value:e.unite,onChange:t=>M(e.id,"unite",t.target.value),onKeyDown:t=>R(t,e.id,"unite",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""}`,required:!0,disabled:o||S[e.id]}),s("datalist",{id:"unite-options",children:ke.map((t,n)=>s("option",{value:t},n))})]})}),s("td",{className:"px-4 py-2",children:s("input",{type:"number",value:e.price,onChange:t=>M(e.id,"price",t.target.value),onKeyDown:t=>R(t,e.id,"price",a),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""}`,min:"0",step:"0.01",required:!0,disabled:o||S[e.id]})}),s("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900 font-medium",children:[parseFloat(e.total_ttc).toFixed(2)," ","MAD"]})}),s("td",{className:"px-4 py-2",children:i("div",{className:"flex space-x-2",children:[s("button",{type:"button",onClick:()=>z(e.id),className:`text-blue-600 hover:text-blue-800 ${e.hasChanges?"":"opacity-50 cursor-not-allowed"}`,disabled:o||!e.hasChanges||S[e.id],title:"Enregistrer cette ligne",children:S[e.id]?s("div",{className:"h-5 w-5 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"}):s(ye,{className:"h-5 w-5"})}),s("button",{type:"button",onClick:()=>te(e.id),className:"text-red-600 hover:text-red-800 disabled:opacity-50",disabled:o||v.length<=1||S[e.id],title:"Supprimer cette ligne",children:s(xe,{className:"h-5 w-5"})})]})})]},e.id)}),s("tr",{className:"bg-gray-50",children:i("td",{colSpan:"8",className:"px-4 py-3",children:[s("div",{className:"font-semibold text-gray-900 mb-2",children:"Totaux par jour"}),s("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:J().map(e=>i("div",{className:"flex justify-between items-center bg-white p-2 rounded-md shadow-sm",children:[s("span",{className:"text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),i("span",{className:"font-medium text-gray-900",children:[parseFloat(e.total).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]},e.date))}),i("div",{className:"mt-3 flex justify-end items-center border-t pt-2",children:[s("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Total du mois:"}),i("span",{className:"text-lg font-bold text-gray-900",children:[J().reduce((e,a)=>e+parseFloat(a.total),0).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]})]})})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:H,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",disabled:o,children:[s(pe,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),s("button",{type:"submit",className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 ${E?"":"opacity-50 cursor-not-allowed"}`,disabled:o||!E,children:o?"Enregistrement...":"Enregistrer tout"})]})]})}),s(Ce,{toasts:w,removeToast:_})]})}export{Re as default};
