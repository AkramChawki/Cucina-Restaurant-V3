import{j as e,i as L,r as x,a,f as N}from"./app-51b88634.js";import{c as f}from"./createLucideIcon-3bf6cea6.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],A=f("CircleAlert",j);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],$=f("CircleCheckBig",R);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],I=f("CirclePlus",B);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],E=f("Trash2",Y);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],P=f("X",O),U=({message:i,type:c="success",onClose:s})=>(x.useEffect(()=>{const b=setTimeout(()=>{s()},3e3);return()=>clearTimeout(b)},[s]),a("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${c==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:c==="success"?e($,{className:"w-5 h-5 text-green-600"}):e(A,{className:"w-5 h-5 text-red-600"})}),e("div",{className:"ml-3 text-sm font-normal",children:i}),e("button",{onClick:s,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:e(P,{className:"w-5 h-5"})})]})),z=({toasts:i,removeToast:c})=>e("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:i.map(s=>e(U,{message:s.message,type:s.type,onClose:()=>c(s.id)},s.id))}),V=()=>{const[i,c]=L.useState([]);return{toasts:i,addToast:(g,h="success")=>{const u=Date.now();c(v=>[...v,{id:u,message:g,type:h}])},removeToast:g=>{c(h=>h.filter(u=>u.id!==g))}}},X={Achat:"achat",Livraison:"livraison",Stock:"stock",Autre:"autre"};function G({restaurant:i,currentMonth:c,existingEntries:s=[],types:b=X,currentType:g=""}){const{toasts:h,addToast:u,removeToast:v}=V(),[o,S]=x.useState(new Date(c.year,c.month-1)),[m,C]=x.useState(g),w={id:1,fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:m,total_ttc:0},[l,y]=x.useState([w]);x.useEffect(()=>{if(s&&s.length>0){const r=s.map((t,n)=>({id:n+1,fournisseur:t.fournisseur||"",designation:t.designation||"",quantity:t.quantity||"",price:t.price||"",unite:t.unite||"",date:t.date||new Date().toISOString().split("T")[0],type:t.type||m,total_ttc:t.total_ttc||0}));y(r)}else y([w])},[s]);const k=(r,t)=>{const n=parseFloat(r)||0,d=parseFloat(t)||0;return(n*d).toFixed(2)},_=()=>{const r={id:l.length+1,fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:m,total_ttc:0};y([...l,r])},q=r=>{l.length>1&&y(l.filter(t=>t.id!==r))},p=(r,t,n)=>{y(l.map(d=>{if(d.id===r){const T={...d,[t]:n};return(t==="quantity"||t==="price")&&(T.total_ttc=k(t==="quantity"?n:d.quantity,t==="price"?n:d.price)),T}return d}))},M=r=>{const t=r.target.value;C(t),N.get(route("BML.show",[i.slug]),{month:o.getMonth()+1,year:o.getFullYear(),type:t},{preserveScroll:!0,preserveState:!0})},D=r=>{const t=new Date(r.target.value);S(t),N.get(route("BML.show",[i.slug]),{month:t.getMonth()+1,year:t.getFullYear(),type:m},{preserveScroll:!0,preserveState:!0})},F=r=>{r.preventDefault();const t={restaurant_id:i.id,rows:l.map(n=>({...n,type:m||n.type,total_ttc:k(n.quantity,n.price)})),month:o.getMonth()+1,year:o.getFullYear()};N.post(route("bml.update-value"),t,{preserveScroll:!0,onSuccess:()=>{u("Les données ont été enregistrées avec succès.","success")},onError:n=>{u("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",n)}})};return a("div",{className:"p-4 sm:p-6",children:[e("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:a("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[a("div",{className:"flex-1 flex items-center gap-4",children:[a("div",{children:[e("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),a("p",{className:"mt-1 text-sm text-gray-600",children:[i.name," - ",o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),a("select",{value:m,onChange:M,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[e("option",{value:"",children:"Tous les types"}),Object.entries(b).map(([r,t])=>e("option",{value:t,children:r},t))]})]}),e("div",{className:"flex-shrink-0",children:e("input",{type:"month",value:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,onChange:D,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),e("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:a("form",{onSubmit:F,children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:a("tr",{children:[e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(r=>a("tr",{children:[e("td",{className:"px-4 py-2",children:e("input",{type:"date",value:r.date,onChange:t=>p(r.id,"date",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.fournisseur,onChange:t=>p(r.id,"fournisseur",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.designation,onChange:t=>p(r.id,"designation",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.quantity,onChange:t=>p(r.id,"quantity",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.unite,onChange:t=>p(r.id,"unite",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.price,onChange:t=>p(r.id,"price",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),e("td",{className:"px-4 py-2",children:a("div",{className:"text-sm text-gray-900",children:[r.total_ttc,"€"]})}),e("td",{className:"px-4 py-2",children:e("button",{type:"button",onClick:()=>q(r.id),className:"text-red-600 hover:text-red-800",children:e(E,{className:"h-5 w-5"})})})]},r.id))})]})}),a("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[a("button",{type:"button",onClick:_,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e(I,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),e("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),e(z,{toasts:h,removeToast:v})]})}export{G as default};
