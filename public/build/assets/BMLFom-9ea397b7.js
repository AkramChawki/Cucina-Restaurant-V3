import{j as t,R as ce,r as h,a as i,q as de,f as R}from"./app-46461f75.js";import{c as q}from"./createLucideIcon-79484a07.js";import{C as Z}from"./circle-alert-c8ade997.js";import{C as ue}from"./calendar-515bfbba.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],me=q("ChevronsUpDown",ge);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],he=q("CircleCheckBig",pe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ye=q("CirclePlus",fe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ve=q("Save",be);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ne=q("Trash2",xe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ce=q("X",we),De=({message:d,type:u="success",onClose:l})=>(h.useEffect(()=>{const S=setTimeout(()=>{l()},3e3);return()=>clearTimeout(S)},[l]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${u==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:u==="success"?t(he,{className:"w-5 h-5 text-green-600"}):t(Z,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:d}),t("button",{onClick:l,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(Ce,{className:"w-5 h-5"})})]})),Se=({toasts:d,removeToast:u})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:d.map(l=>t(De,{message:l.message,type:l.type,onClose:()=>u(l.id)},l.id))}),ke=()=>{const[d,u]=ce.useState([]);return{toasts:d,addToast:(f,N="success")=>{const w=Date.now();u(a=>[...a,{id:w,message:f,type:N}])},removeToast:f=>{u(N=>N.filter(w=>w.id!==f))}}},V={gastro:["Mozzarella Milka","Creme Fraîche","PERLA CERISE","Mozzarella cerise"],giada:["Mozzarella","Stracciatella","Buratta","Ricotta"],legume:["Roquette","EPINARD","Tomate cerise","Poivron Rouge","Poivron vert","CHAMPIGNON","CITRON","ORANGUE","CONCOMBRE","AIL","Basilic","Courgette","OIGNON"],boisson:["Coca","Coca Zero","Hawaei","Sprite","POMS","Citron","Tonic","Ouelmes","EAU"]},Me=["KG","250G","unite","L","Botte","paquet de 24 U","Pot de 1 kg"],E=d=>{if(!d)return"";try{const u=d instanceof Date?d:new Date(d),l=u.getTimezoneOffset()*6e4;return new Date(u.getTime()-l).toISOString().split("T")[0]}catch(u){return console.error("Error formatting date:",u),""}},B=d=>{switch(d){case"gastro":return"GASTRO";case"giada":return"GIADA";case"legume":return"Legume";case"boisson":return"COCA COLA";default:return""}},Fe=({value:d,onChange:u,disabled:l})=>{const[S,f]=h.useState(!1),N=h.useRef(null),w=new Date(d);h.useEffect(()=>{const m=c=>{N.current&&!N.current.contains(c.target)&&f(!1)};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[N]);const a=new Date().getFullYear(),z=Array.from({length:6},(m,c)=>a-c),g=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],L=m=>{const c=new Date(w.getFullYear(),m);u(c),f(!1)},b=m=>{const c=new Date(m,w.getMonth());u(c),f(!1)};return i("div",{className:"relative",ref:N,children:[i("button",{type:"button",onClick:()=>!l&&f(!S),className:`flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm ${l?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,disabled:l,children:[t(ue,{className:"w-4 h-4 mr-2 text-gray-500"}),i("span",{children:[g[w.getMonth()]," ",w.getFullYear()]}),t(me,{className:"w-4 h-4 ml-2 text-gray-500"})]}),S&&i("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-2 w-64",children:[i("div",{className:"mb-2",children:[t("div",{className:"font-medium text-gray-700 mb-1",children:"Mois"}),t("div",{className:"grid grid-cols-3 gap-1",children:g.map((m,c)=>t("button",{type:"button",className:`text-sm p-1 rounded ${w.getMonth()===c?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>L(c),children:m.substring(0,3)},m))})]}),i("div",{children:[t("div",{className:"font-medium text-gray-700 mb-1",children:"Année"}),t("div",{className:"grid grid-cols-3 gap-1",children:z.map(m=>t("button",{type:"button",className:`text-sm p-1 rounded ${w.getFullYear()===m?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>b(m),children:m},m))})]})]})]})};function $e({restaurant:d,currentMonth:u,existingEntries:l=[],types:S={},currentType:f=""}){const{auth:N,processing:w}=de().props,a=!!N.user.guest;console.log("Guest status:",N.user.guest,"isGuest:",a);const{toasts:z,addToast:g,removeToast:L}=ke(),[b,m]=h.useState(new Date(u.year,u.month-1)),[c,Y]=h.useState(()=>(console.log("Setting initial selectedType:",f),String(f||""))),[p,C]=h.useState(!1),[D,M]=h.useState({}),G=h.useRef(!0),P=h.useRef(l),[ee,U]=h.useState(null),[v,te]=h.useState({key:"date",direction:"ascending"});h.useEffect(()=>{console.log("currentType prop changed to:",f),f!==c&&(console.log("Updating selectedType state from prop"),Y(String(f||"")))},[f]),h.useEffect(()=>{d&&(!l||l.length===0)&&R.get(route("bml.show",[d.slug]),{month:b.getMonth()+1,year:b.getFullYear(),type:c},{preserveScroll:!0,preserveState:!0,onFinish:()=>C(!1)})},[d]);const I=()=>({id:Date.now()+Math.floor(Math.random()*1e3),fournisseur:B(c),designation:"",quantity:"",price:"",unite:"",date:E(new Date),type:c,total_ttc:0,isNew:!0,isSaving:!1,hasChanges:!1}),[x,k]=h.useState([I()]),A=x.some(e=>e.hasChanges),re=e=>e.reduce((n,s)=>{const o=s.date;return o&&(n[o]||(n[o]={rows:[],total:0}),n[o].rows.push(s),n[o].total+=parseFloat(s.total_ttc)||0),n},{});h.useEffect(()=>{if(G.current){G.current=!1;return}const e=JSON.stringify(P.current)!==JSON.stringify(l);if(P.current=l,!!e)if(l&&l.length>0){const r=l.map((n,s)=>({id:Date.now()+s,fournisseur:n.fournisseur||B(n.type),designation:n.designation||"",quantity:n.quantity||"",price:n.price||"",unite:n.unite||"",date:E(n.date),type:n.type||c,total_ttc:parseFloat(n.total_ttc)||0,isNew:!1,isSaving:!1,hasChanges:!1,originalId:n.id}));k(r)}else k([I()])},[l]);const se=[...x].sort((e,r)=>{if(!e[v.key]||!r[v.key])return 0;if(v.key==="date"){const o=new Date(e.date),y=new Date(r.date);return v.direction==="ascending"?o-y:y-o}const n=e[v.key].toString().toLowerCase(),s=r[v.key].toString().toLowerCase();return n<s?v.direction==="ascending"?-1:1:n>s?v.direction==="ascending"?1:-1:0}),K=e=>{let r="ascending";v.key===e&&v.direction==="ascending"&&(r="descending"),te({key:e,direction:r})},H=e=>v.key!==e?null:t("span",{className:"ml-1",children:v.direction==="ascending"?"▲":"▼"}),j=(e,r)=>{const n=parseFloat(e)||0,s=parseFloat(r)||0;return(n*s).toFixed(2)},$=e=>{if(!e)return!1;const r=new Date(e);return r.getMonth()+1!==b.getMonth()+1||r.getFullYear()!==b.getFullYear()},J=()=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas ajouter de lignes.","warning");return}k(e=>[...e,I()])},ne=async e=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas supprimer de lignes.","warning");return}const r=x.find(n=>n.id===e);if(r){if(x.length<=1){g("Impossible de supprimer la seule ligne","warning");return}if(!r.isNew&&r.originalId){if(!confirm("Êtes-vous sûr de vouloir supprimer cette ligne?"))return;M(n=>({...n,[e]:!0}));try{R.post(route("bml.delete"),{id:r.originalId,restaurant_id:d.id},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:n=>{console.error("Delete error:",n),g("Erreur lors de la suppression","error"),M(s=>({...s,[e]:!1}))}})}catch(n){g("Erreur lors de la suppression","error"),console.error("Error deleting row:",n),M(s=>({...s,[e]:!1}))}}else k(n=>n.filter(s=>s.id!==e)),M(n=>{const s={...n};return delete s[e],s})}},X=async e=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const r=x.find(n=>n.id===e);if(r){if(!r.date||!r.fournisseur||!r.designation||!r.quantity||!r.price||!r.unite){g("Veuillez remplir tous les champs obligatoires.","error");return}if($(r.date)){const s=new Date(r.date).toLocaleDateString("fr-FR");if(!confirm(`Attention: La date sélectionnée (${s}) est en dehors du mois actuel. Cette entrée sera automatiquement placée dans le mois correspondant à sa date. Voulez-vous continuer?`))return}k(n=>n.map(s=>s.id===e?{...s,isSaving:!0}:s)),M(n=>({...n,[e]:!0}));try{const n=new Date(r.date),s={...r,date:E(n),type:c||r.type||"gastro",total_ttc:j(r.quantity,r.price)},o={restaurant_id:d.id,rows:[s],month:n.getMonth()+1,year:n.getFullYear(),type:c||"gastro",day_total:parseFloat(s.total_ttc).toFixed(2)};await R.post(route("bml.update-value"),o,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:y=>{console.error("Save error:",y),g("Erreur lors de l'enregistrement","error"),k(_=>_.map(O=>O.id===e?{...O,isSaving:!1}:O)),M(_=>({..._,[e]:!1}))}})}catch(n){console.error("Error saving row:",n),g("Erreur lors de l'enregistrement","error"),k(s=>s.map(o=>o.id===e?{...o,isSaving:!1}:o)),M(s=>({...s,[e]:!1}))}}},F=(e,r,n)=>{a||k(s=>s.map(o=>{if(o.id===e){const y={...o,[r]:n,hasChanges:!0};return r==="type"&&(y.fournisseur=B(n)),(r==="quantity"||r==="price")&&(y.total_ttc=j(r==="quantity"?n:o.quantity,r==="price"?n:o.price)),y}return o}))},ae=e=>{try{const r=e.target.value;if(console.log("Type changed to:",r),A&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;Y(r),C(!0);const n=route("bml.filter",[d.slug]);console.log("Using filter endpoint:",n,"with type:",r),R.get(n,{month:b.getMonth()+1,year:b.getFullYear(),type:r},{preserveScroll:!0,preserveState:!0,onSuccess:s=>{console.log("Filter successful",s),C(!1)},onError:s=>{console.error("Filter error:",s),C(!1),g("Erreur lors du chargement des données.","error")}})}catch(r){console.error("Error in handleTypeChange:",r),C(!1),g("Une erreur est survenue lors du changement de type.","error")}},oe=e=>{if(A&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;m(e),C(!0);const r=route("bml.filter",[d.slug]);console.log("Using filter endpoint for month change:",r),R.get(r,{month:e.getMonth()+1,year:e.getFullYear(),type:c},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{console.log("Month filter successful",n),C(!1)},onError:n=>{console.error("Month filter error:",n),C(!1),g("Erreur lors du chargement des données.","error")}})},Q=()=>{const e=re(x);return Object.entries(e).map(([r,n])=>({date:r,total:n.total.toFixed(2)})).sort((r,n)=>r.date.localeCompare(n.date))},ie=e=>{if(e.preventDefault(),a){g("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const r=x.filter(o=>o.hasChanges);if(r.length===0){g("Aucune modification à enregistrer.","info");return}if(!confirm(`Voulez-vous enregistrer ${r.length} ligne(s) modifiée(s)?`))return;const n=r.map(o=>{const y=new Date(o.date);return{...o,date:E(y),type:c||o.type||"gastro",total_ttc:j(o.quantity,o.price)}}),s={restaurant_id:d.id,rows:n,month:b.getMonth()+1,year:b.getFullYear(),type:c||"gastro",day_total:n.reduce((o,y)=>o+parseFloat(y.total_ttc),0).toFixed(2)};C(!0),R.post(route("bml.store"),s,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:o=>{console.error("Save error:",o),g("Erreur lors de l'enregistrement","error"),C(!1)}})},T=(e,r,n,s)=>{if(!a){if(e.key==="Enter"){e.preventDefault(),X(r);return}if(e.key==="Tab"&&!e.shiftKey){const o=["date","fournisseur","designation","quantity","unite","price"];o.indexOf(n)===o.length-1&&(e.preventDefault(),s===x.length-1&&J(),setTimeout(()=>{const O=s+1;if(O<x.length){const le=x[O].id,W=document.querySelector(`input[name="date-${le}"]`);W&&W.focus()}},0))}}};return i("div",{className:"p-4 sm:p-6",children:[a&&t("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg mb-4 p-3",children:i("div",{className:"flex items-center justify-center",children:[t(Z,{className:"h-5 w-5 text-yellow-600 mr-2"}),t("span",{className:"font-medium text-yellow-800",children:"Mode consultation uniquement. Vous ne pouvez pas modifier les données."})]})}),t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[d.name," -"," ",b.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),t("div",{className:"relative",children:i("select",{value:c,onChange:ae,className:`block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 py-2 pl-3 pr-10 text-base bg-gray-100 cursor-not-allowed" : ""
                                }`,disabled:p,children:[t("option",{value:"",children:"Tous les types"}),Object.entries(S).map(([e,r])=>t("option",{value:r,children:e},r))]})})]}),t("div",{className:"flex-shrink-0",children:t(Fe,{value:b,onChange:oe,disabled:p})})]})}),t("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:i("form",{onSubmit:ie,children:[p&&t("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i("div",{className:"text-center",children:[t("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),t("p",{className:"mt-2 text-gray-600",children:"Chargement en cours..."})]})}),t("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:i("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("date"),children:i("div",{className:"flex items-center",children:["Date ",H("date")]})}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("designation"),children:i("div",{className:"flex items-center",children:["Designation"," ",H("designation")]})}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Actions"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[se.map((e,r)=>{var n;return i("tr",{className:`hover:bg-gray-50 transition-colors duration-150 ${e.hasChanges?"bg-blue-50":""}`,children:[i("td",{className:`px-4 py-2 ${$(e.date)?"bg-yellow-50":""}`,children:[i("div",{className:"relative",children:[t("input",{name:`date-${e.id}`,type:"date",value:e.date||"",onChange:s=>F(e.id,"date",s.target.value),onKeyDown:s=>T(s,e.id,"date",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${$(e.date)?"border-yellow-400 bg-yellow-50":""} ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a,max:E(new Date)}),$(e.date)&&t("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:t("svg",{className:"h-5 w-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),$(e.date)&&t("div",{className:"text-xs text-yellow-600 mt-1",children:"Date hors du mois sélectionné"})]}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:e.fournisseur,onChange:s=>F(e.id,"fournisseur",s.target.value),onKeyDown:s=>T(s,e.id,"fournisseur",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:!0,readOnly:!0})}),i("td",{className:"px-4 py-2 relative",children:[t("input",{id:`designation-${e.id}`,type:"text",value:e.designation,onChange:s=>F(e.id,"designation",s.target.value),onKeyDown:s=>T(s,e.id,"designation",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a,autoComplete:"off",onFocus:()=>!a&&U(e.id),onBlur:()=>{setTimeout(()=>U(null),200)}}),!p&&!a&&ee===e.id&&i("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-md z-50 max-h-40 overflow-y-auto",children:[(n=V[c])==null?void 0:n.map((s,o)=>t("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onMouseDown:y=>{y.preventDefault(),F(e.id,"designation",s)},children:s},o)),(!V[c]||V[c].length===0)&&t("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Aucune suggestion"})]})]}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:e.quantity,onChange:s=>F(e.id,"quantity",s.target.value),onKeyDown:s=>T(s,e.id,"quantity",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:p||D[e.id]||a,readOnly:a})}),t("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[t("input",{type:"text",list:"unite-options",value:e.unite,onChange:s=>F(e.id,"unite",s.target.value),onKeyDown:s=>T(s,e.id,"unite",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a}),t("datalist",{id:"unite-options",children:Me.map((s,o)=>t("option",{value:s},o))})]})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:e.price,onChange:s=>F(e.id,"price",s.target.value),onKeyDown:s=>T(s,e.id,"price",r),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:p||D[e.id]||a,readOnly:a})}),t("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900 font-medium",children:[parseFloat(e.total_ttc).toFixed(2)," ","MAD"]})}),t("td",{className:"px-4 py-2",children:i("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>X(e.id),className:`text-blue-600 hover:text-blue-800 ${!e.hasChanges||a?"opacity-50 cursor-not-allowed":""}`,disabled:p||!e.hasChanges||D[e.id]||a,title:a?"Mode consultation uniquement":"Enregistrer cette ligne",children:D[e.id]?t("div",{className:"h-5 w-5 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"}):t(ve,{className:"h-5 w-5"})}),t("button",{type:"button",onClick:()=>ne(e.id),className:`text-red-600 hover:text-red-800 ${a||x.length<=1||D[e.id]?"opacity-50 cursor-not-allowed":""}`,disabled:p||x.length<=1||D[e.id]||a,title:a?"Mode consultation uniquement":"Supprimer cette ligne",children:t(Ne,{className:"h-5 w-5"})})]})})]},e.id)}),t("tr",{className:"bg-gray-50",children:i("td",{colSpan:"8",className:"px-4 py-3",children:[t("div",{className:"font-semibold text-gray-900 mb-2",children:"Totaux par jour"}),t("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Q().map(e=>i("div",{className:"flex justify-between items-center bg-white p-2 rounded-md shadow-sm",children:[t("span",{className:"text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),i("span",{className:"font-medium text-gray-900",children:[parseFloat(e.total).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]},e.date))}),i("div",{className:"mt-3 flex justify-end items-center border-t pt-2",children:[t("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Total du mois:"}),i("span",{className:"text-lg font-bold text-gray-900",children:[Q().reduce((e,r)=>e+parseFloat(r.total),0).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]})]})})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:J,className:`inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ${p||a?"opacity-50 cursor-not-allowed":""}`,disabled:p||a,title:a?"Mode consultation uniquement":"Ajouter une ligne",children:[t(ye,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${!A||a||p?"opacity-50 cursor-not-allowed":""}`,disabled:p||!A||a,title:a?"Mode consultation uniquement":"Enregistrer toutes les modifications",children:p?"Enregistrement...":"Enregistrer tout"})]})]})}),t(Se,{toasts:z,removeToast:L})]})}export{$e as default};
