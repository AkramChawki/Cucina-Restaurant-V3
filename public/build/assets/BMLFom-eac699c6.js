import{j as e,i as A,r as h,a as n,f as N}from"./app-0eaf048b.js";import{c as y}from"./createLucideIcon-3fc0caf5.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],$=y("CircleAlert",L);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Y=y("CircleCheckBig",R);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],E=y("CirclePlus",B);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],P=y("Trash2",I);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],U=y("X",O),z=({message:i,type:c="success",onClose:a})=>(h.useEffect(()=>{const x=setTimeout(()=>{a()},3e3);return()=>clearTimeout(x)},[a]),n("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${c==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:c==="success"?e(Y,{className:"w-5 h-5 text-green-600"}):e($,{className:"w-5 h-5 text-red-600"})}),e("div",{className:"ml-3 text-sm font-normal",children:i}),e("button",{onClick:a,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:e(U,{className:"w-5 h-5"})})]})),V=({toasts:i,removeToast:c})=>e("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:i.map(a=>e(z,{message:a.message,type:a.type,onClose:()=>c(a.id)},a.id))}),X=()=>{const[i,c]=A.useState([]);return{toasts:i,addToast:(u,m="success")=>{const l=Date.now();c(b=>[...b,{id:l,message:u,type:m}])},removeToast:u=>{c(m=>m.filter(l=>l.id!==u))}}},H={Achat:"achat",Livraison:"livraison",Stock:"stock",Autre:"autre"};function J({restaurant:i,currentMonth:c,existingEntries:a=[],types:x=H,currentType:u=""}){const{toasts:m,addToast:l,removeToast:b}=X(),[o,S]=h.useState(new Date(c.year,c.month-1)),[p,_]=h.useState(u),w=()=>({id:Date.now(),fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:p,total_ttc:0}),[k,f]=h.useState([w()]);h.useEffect(()=>{if(a&&a.length>0){const r=a.map((t,s)=>({id:Date.now()+s,fournisseur:t.fournisseur||"",designation:t.designation||"",quantity:t.quantity||"",price:t.price||"",unite:t.unite||"",date:t.date||new Date().toISOString().split("T")[0],type:t.type||p,total_ttc:t.total_ttc||0}));f(r)}},[a]);const T=(r,t)=>{const s=parseFloat(r)||0,v=parseFloat(t)||0;return(s*v).toFixed(2)},q=()=>{f(r=>[...r,w()])},D=r=>{f(t=>t.length<=1?t:t.filter(s=>s.id!==r))},d=(r,t,s)=>{f(v=>v.map(g=>{if(g.id===r){const C={...g,[t]:s};return(t==="quantity"||t==="price")&&(C.total_ttc=T(t==="quantity"?s:g.quantity,t==="price"?s:g.price)),C}return g}))},M=r=>{const t=r.target.value;_(t),N.get(route("bml.show",[i.slug]),{month:o.getMonth()+1,year:o.getFullYear(),type:t},{preserveScroll:!0,preserveState:!0})},F=r=>{const t=new Date(r.target.value);S(t),N.get(route("bml.show",[i.slug]),{month:t.getMonth()+1,year:t.getFullYear(),type:p},{preserveScroll:!0,preserveState:!0})},j=r=>{r.preventDefault();const t={restaurant_id:i.id,rows:k.map(s=>({...s,type:p||s.type,total_ttc:T(s.quantity,s.price)})),month:o.getMonth()+1,year:o.getFullYear()};N.post(route("bml.update-value"),t,{preserveScroll:!0,onSuccess:()=>{l("Les données ont été enregistrées avec succès.","success")},onError:s=>{l("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",s)}})};return n("div",{className:"p-4 sm:p-6",children:[e("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:n("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[n("div",{className:"flex-1 flex items-center gap-4",children:[n("div",{children:[e("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),n("p",{className:"mt-1 text-sm text-gray-600",children:[i.name," - ",o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),n("select",{value:p,onChange:M,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[e("option",{value:"",children:"Tous les types"}),Object.entries(x).map(([r,t])=>e("option",{value:t,children:r},t))]})]}),e("div",{className:"flex-shrink-0",children:e("input",{type:"month",value:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,onChange:F,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),e("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:n("form",{onSubmit:j,children:[e("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:n("tr",{children:[e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(r=>n("tr",{children:[e("td",{className:"px-4 py-2",children:e("input",{type:"date",value:r.date,onChange:t=>d(r.id,"date",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.fournisseur,onChange:t=>d(r.id,"fournisseur",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.designation,onChange:t=>d(r.id,"designation",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.quantity,onChange:t=>d(r.id,"quantity",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.unite,onChange:t=>d(r.id,"unite",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.price,onChange:t=>d(r.id,"price",t.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),e("td",{className:"px-4 py-2",children:n("div",{className:"text-sm text-gray-900",children:[r.total_ttc,"€"]})}),e("td",{className:"px-4 py-2",children:e("button",{type:"button",onClick:()=>D(r.id),className:"text-red-600 hover:text-red-800",children:e(P,{className:"h-5 w-5"})})})]},r.id))})]})}),n("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[n("button",{type:"button",onClick:q,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e(E,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),e("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),e(V,{toasts:m,removeToast:b})]})}export{J as default};
