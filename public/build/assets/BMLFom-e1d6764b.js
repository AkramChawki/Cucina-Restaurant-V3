import{j as t,i as A,r as y,a as i,f as w}from"./app-6289337a.js";import{c as b}from"./createLucideIcon-11d0f0de.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],L=b("CircleAlert",E);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],$=b("CircleCheckBig",R);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Y=b("CirclePlus",I);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],B=b("Trash2",O);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],U=b("X",P),z=({message:c,type:o="success",onClose:a})=>(y.useEffect(()=>{const v=setTimeout(()=>{a()},3e3);return()=>clearTimeout(v)},[a]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${o==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:o==="success"?t($,{className:"w-5 h-5 text-green-600"}):t(L,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:c}),t("button",{onClick:a,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(U,{className:"w-5 h-5"})})]})),V=({toasts:c,removeToast:o})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:c.map(a=>t(z,{message:a.message,type:a.type,onClose:()=>o(a.id)},a.id))}),X=()=>{const[c,o]=A.useState([]);return{toasts:c,addToast:(x,f="success")=>{const p=Date.now();o(k=>[...k,{id:p,message:x,type:f}])},removeToast:x=>{o(f=>f.filter(p=>p.id!==x))}}},H={Achat:"achat",Livraison:"livraison",Stock:"stock",Autre:"autre"};function J({restaurant:c,currentMonth:o,existingEntries:a=[],types:v=H,currentType:x=""}){const{toasts:f,addToast:p,removeToast:k}=X(),[l,C]=y.useState(new Date(o.year,o.month-1)),[d,_]=y.useState(x),N=()=>({id:Date.now(),fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:d,total_ttc:0}),[S,u]=y.useState([N()]);y.useEffect(()=>{if(a&&a.length>0){const s=a.map((e,n)=>({id:Date.now()+n,fournisseur:e.fournisseur||"",designation:e.designation||"",quantity:e.quantity||"",price:e.price||"",unite:e.unite||"",date:e.date||new Date().toISOString().split("T")[0],type:e.type||d,total_ttc:e.total_ttc||0}));u(s)}},[a]);const T=(s,e)=>{const n=parseFloat(s)||0,m=parseFloat(e)||0;return(n*m).toFixed(2)},q=()=>{u(s=>[...s,N()])},D=s=>{u(e=>e.length<=1?e:e.filter(n=>n.id!==s))},g=(s,e,n)=>{u(m=>m.map(r=>{if(r.id===s){const h={...r,[e]:n};return(e==="quantity"||e==="price")&&(h.total_ttc=T(e==="quantity"?n:r.quantity,e==="price"?n:r.price)),h}return r}))},M=s=>{const e=s.target.value;_(e),u([N()]),w.get(route("bml.show",[c.slug]),{month:l.getMonth()+1,year:l.getFullYear(),type:e},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{if(n.props.existingEntries.length>0){const m=n.props.existingEntries.map((r,h)=>({id:Date.now()+h,fournisseur:r.fournisseur||"",designation:r.designation||"",quantity:r.quantity||"",price:r.price||"",unite:r.unite||"",date:r.date||new Date().toISOString().split("T")[0],type:r.type||e,total_ttc:r.total_ttc||0}));u(m)}}})},F=s=>{const e=new Date(s.target.value);C(e),u([N()]),w.get(route("bml.show",[c.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:d},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{if(n.props.existingEntries.length>0){const m=n.props.existingEntries.map((r,h)=>({id:Date.now()+h,fournisseur:r.fournisseur||"",designation:r.designation||"",quantity:r.quantity||"",price:r.price||"",unite:r.unite||"",date:r.date||new Date().toISOString().split("T")[0],type:r.type||d,total_ttc:r.total_ttc||0}));u(m)}}})},j=s=>{s.preventDefault();const e={restaurant_id:c.id,rows:S.map(n=>({...n,type:d||n.type,total_ttc:T(n.quantity,n.price)})),month:l.getMonth()+1,year:l.getFullYear(),type:d};w.post(route("bml.update-value"),e,{preserveScroll:!0,onSuccess:()=>{p("Les données ont été enregistrées avec succès.","success"),w.get(route("bml.show",[c.slug]),{month:l.getMonth()+1,year:l.getFullYear(),type:d},{preserveScroll:!0,preserveState:!0})},onError:n=>{p("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",n)}})};return i("div",{className:"p-4 sm:p-6",children:[t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[c.name," - ",l.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),i("select",{value:d,onChange:M,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[t("option",{value:"",children:"Tous les types"}),Object.entries(v).map(([s,e])=>t("option",{value:e,children:s},e))]})]}),t("div",{className:"flex-shrink-0",children:t("input",{type:"month",value:`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,onChange:F,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),t("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:i("form",{onSubmit:j,children:[t("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:i("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),t("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(s=>i("tr",{children:[t("td",{className:"px-4 py-2",children:t("input",{type:"date",value:s.date,onChange:e=>g(s.id,"date",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.fournisseur,onChange:e=>g(s.id,"fournisseur",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.designation,onChange:e=>g(s.id,"designation",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.quantity,onChange:e=>g(s.id,"quantity",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.unite,onChange:e=>g(s.id,"unite",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.price,onChange:e=>g(s.id,"price",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900",children:[s.total_ttc,"€"]})}),t("td",{className:"px-4 py-2",children:t("button",{type:"button",onClick:()=>D(s.id),className:"text-red-600 hover:text-red-800",children:t(B,{className:"h-5 w-5"})})})]},s.id))})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:q,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[t(Y,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),t(V,{toasts:f,removeToast:k})]})}export{J as default};
