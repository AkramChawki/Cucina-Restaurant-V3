import{j as e,R as $,r as x,a as i,f as T}from"./app-97a07396.js";import{c as C}from"./createLucideIcon-ef2c0e35.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Y=C("CircleAlert",U);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],V=C("CircleCheckBig",H);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],K=C("CirclePlus",J);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Q=C("Trash2",X);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],W=C("X",Z),ee=({message:o,type:l="success",onClose:n})=>(x.useEffect(()=>{const h=setTimeout(()=>{n()},3e3);return()=>clearTimeout(h)},[n]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${l==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:l==="success"?e(V,{className:"w-5 h-5 text-green-600"}):e(Y,{className:"w-5 h-5 text-red-600"})}),e("div",{className:"ml-3 text-sm font-normal",children:o}),e("button",{onClick:n,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:e(W,{className:"w-5 h-5"})})]})),te=({toasts:o,removeToast:l})=>e("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:o.map(n=>e(ee,{message:n.message,type:n.type,onClose:()=>l(n.id)},n.id))}),re=()=>{const[o,l]=$.useState([]);return{toasts:o,addToast:(m,v="success")=>{const d=Date.now();l(D=>[...D,{id:d,message:m,type:v}])},removeToast:m=>{l(v=>v.filter(d=>d.id!==m))}}},ae={gastro:["Mozzarella Milka","Creme Fraîche","PERLA CERISE","Mozzarella cerise"],giada:["Mozzarella","Stracciatella","Buratta","Ricotta"],legume:["Roquette","EPINARD","Tomate cerise","Poivron Rouge","Poivron vert","CHAMPIGNON","CITRON","ORANGUE","CONCOMBRE","AIL","Basilic","Courgette","OIGNON"],boisson:["Coca","Coca Zero","Hawaei","Sprite","POMS","Citron","Tonic"]},se=["Kg","KG","250G","unite","L","Botte","BROT","paquet de 24 U","Pot de 1 kg"],F=o=>{if(!o)return"";try{const l=o instanceof Date?o:new Date(o),n=l.getTimezoneOffset()*6e4;return new Date(l.getTime()-n).toISOString().split("T")[0]}catch(l){return console.error("Error formatting date:",l),""}},ne=o=>o.reduce((n,h)=>{const m=h.date;return m&&(n[m]||(n[m]={rows:[],total:0}),n[m].rows.push(h),n[m].total+=parseFloat(h.total_ttc)||0),n},{}),M=o=>{switch(o){case"gastro":return"GASTRO";case"giada":return"GIADA";case"legume":return"Legume";case"boisson":return"COCA COLA";default:return""}};function le({restaurant:o,currentMonth:l,existingEntries:n=[],types:h={},currentType:m=""}){const{toasts:v,addToast:d,removeToast:D}=re(),[y,A]=x.useState(new Date(l.year,l.month-1)),[g,E]=x.useState(m),[u,p]=x.useState(!1),R=x.useRef(!0),O=x.useRef(n),S=()=>({id:Date.now()+Math.floor(Math.random()*1e3),fournisseur:M(g),designation:"",quantity:"",price:"",unite:"",date:F(new Date),type:g,total_ttc:0}),[b,k]=x.useState([S()]);x.useEffect(()=>{if(R.current){R.current=!1;return}const r=JSON.stringify(O.current)!==JSON.stringify(n);if(O.current=n,!!r)if(n&&n.length>0){const t=n.map((s,f)=>({id:Date.now()+f,fournisseur:s.fournisseur||M(s.type),designation:s.designation||"",quantity:s.quantity||"",price:s.price||"",unite:s.unite||"",date:F(s.date),type:s.type||g,total_ttc:parseFloat(s.total_ttc)||0}));k(t)}else k([S()])},[n]);const q=(r,t)=>{const s=parseFloat(r)||0,f=parseFloat(t)||0;return(s*f).toFixed(2)},L=()=>{k(r=>[...r,S()])},I=r=>{k(t=>t.length<=1?t:t.filter(s=>s.id!==r))},N=(r,t,s)=>{k(f=>f.map(c=>{if(c.id===r){const w={...c,[t]:s};return t==="type"&&(w.fournisseur=M(s)),(t==="quantity"||t==="price")&&(w.total_ttc=q(t==="quantity"?s:c.quantity,t==="price"?s:c.price)),w}return c}))},j=r=>{try{const t=r.target.value;console.log("Type changed to:",t),E(t),p(!0);const s=t===""?null:t,f=route("bml.show",[o.slug]);console.log("Navigating to:",f,"with type:",s),T.get(f,{month:y.getMonth()+1,year:y.getFullYear(),type:s},{preserveScroll:!0,preserveState:!0,onSuccess:c=>{console.log("Navigation successful",c),p(!1)},onError:c=>{console.error("Navigation error:",c),p(!1),d("Erreur lors du chargement des données.","error")}})}catch(t){console.error("Error in handleTypeChange:",t),p(!1),d("Une erreur est survenue lors du changement de type.","error")}},B=r=>{const t=new Date(r.target.value);A(t),p(!0),T.get(route("bml.show",[o.slug]),{month:t.getMonth()+1,year:t.getFullYear(),type:g},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{p(!1)},onError:()=>{p(!1),d("Erreur lors du chargement des données.","error")}})},_=()=>{const r=ne(b);return Object.entries(r).map(([t,s])=>({date:t,total:s.total.toFixed(2)})).sort((t,s)=>t.date.localeCompare(s.date))},P=r=>{if(r.preventDefault(),b.length===0||b.every(a=>!a.designation)){d("Aucune donnée à enregistrer.","warning");return}if(b.filter(a=>a.designation||a.quantity||a.price).some(a=>!a.date||!a.fournisseur||!a.designation||!a.quantity||!a.price||!a.unite)){d("Veuillez remplir tous les champs obligatoires.","error");return}p(!0);const c=b.filter(a=>a.date&&a.fournisseur&&a.designation&&a.quantity&&a.price&&a.unite).map(a=>({...a,date:F(a.date),type:g||a.type||"gastro",total_ttc:q(a.quantity,a.price)})),w={restaurant_id:o.id,rows:c,month:y.getMonth()+1,year:y.getFullYear(),type:g||"gastro",day_total:c.reduce((a,G)=>a+parseFloat(G.total_ttc),0).toFixed(2)};c.length>0?T.post(route("bml.update-value"),w,{onSuccess:()=>{d("Les données ont été enregistrées avec succès.","success"),p(!1);const a=g===""?null:g;T.get(route("bml.show",[o.slug]),{month:y.getMonth()+1,year:y.getFullYear(),type:a},{preserveScroll:!0,preserveState:!0})},onError:a=>{p(!1),d("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",a)}}):(p(!1),d("Aucune donnée valide à enregistrer.","warning"))},z=()=>g?ae[g]||[]:[];return i("div",{className:"p-4 sm:p-6",children:[e("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[e("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[o.name," - ",y.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),e("div",{className:"relative",children:i("select",{value:g,onChange:j,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 py-2 pl-3 pr-10 text-base",disabled:u,children:[e("option",{value:"",children:"Tous les types"}),Object.entries(h).map(([r,t])=>e("option",{value:t,children:r},t))]})})]}),e("div",{className:"flex-shrink-0",children:e("input",{type:"month",value:`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`,onChange:B,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",disabled:u})})]})}),e("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:i("form",{onSubmit:P,children:[u&&i("div",{className:"p-4 text-center",children:[e("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),e("p",{className:"mt-2 text-gray-600",children:"Chargement en cours..."})]}),e("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:i("tr",{children:[e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Date"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Fournisseur"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Designation"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Quantité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Unité"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Prix"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Total TTC"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Action"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[b.map(r=>i("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[e("td",{className:"px-4 py-2",children:e("input",{type:"date",value:r.date||"",onChange:t=>N(r.id,"date",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",required:!0,disabled:u})}),e("td",{className:"px-4 py-2",children:e("input",{type:"text",value:r.fournisseur,onChange:t=>N(r.id,"fournisseur",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",required:!0,disabled:!0})}),e("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[e("input",{type:"text",list:`designations-${r.id}`,value:r.designation,onChange:t=>N(r.id,"designation",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",required:!0,disabled:u}),e("datalist",{id:`designations-${r.id}`,children:z().map((t,s)=>e("option",{value:t},s))})]})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.quantity,onChange:t=>N(r.id,"quantity",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",min:"0",step:"0.01",required:!0,disabled:u})}),e("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[e("input",{type:"text",list:"unite-options",value:r.unite,onChange:t=>N(r.id,"unite",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",required:!0,disabled:u}),e("datalist",{id:"unite-options",children:se.map((t,s)=>e("option",{value:t},s))})]})}),e("td",{className:"px-4 py-2",children:e("input",{type:"number",value:r.price,onChange:t=>N(r.id,"price",t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150",min:"0",step:"0.01",required:!0,disabled:u})}),e("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900 font-medium",children:[parseFloat(r.total_ttc).toFixed(2)," MAD"]})}),e("td",{className:"px-4 py-2",children:e("button",{type:"button",onClick:()=>I(r.id),className:"text-red-600 hover:text-red-800 disabled:opacity-50",disabled:u||b.length<=1,children:e(Q,{className:"h-5 w-5"})})})]},r.id)),e("tr",{className:"bg-gray-50",children:i("td",{colSpan:"8",className:"px-4 py-3",children:[e("div",{className:"font-semibold text-gray-900 mb-2",children:"Totaux par jour"}),e("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:_().map(r=>i("div",{className:"flex justify-between items-center bg-white p-2 rounded-md shadow-sm",children:[e("span",{className:"text-sm text-gray-600",children:new Date(r.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),i("span",{className:"font-medium text-gray-900",children:[parseFloat(r.total).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," MAD"]})]},r.date))}),i("div",{className:"mt-3 flex justify-end items-center border-t pt-2",children:[e("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Total du mois:"}),i("span",{className:"text-lg font-bold text-gray-900",children:[_().reduce((r,t)=>r+parseFloat(t.total),0).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," MAD"]})]})]})})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:L,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",disabled:u,children:[e(K,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),e("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",disabled:u,children:u?"Enregistrement...":"Enregistrer"})]})]})}),e(te,{toasts:v,removeToast:D})]})}export{le as default};
