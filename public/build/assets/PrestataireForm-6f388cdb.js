import{q as y,r as m,W as w,a as s,j as e}from"./app-09bff3f3.js";function k({type:p,existingData:n}){const{auth:h}=y().props,[d,i]=m.useState(!1),{data:t,setData:a,post:u,processing:c,errors:N}=w({name:h.user.name,date:new Date().toISOString().split("T")[0],type:p,prestataires:(n==null?void 0:n.prestataires)||[],lot:"",nom:"",telephone:""});m.useEffect(()=>{n!=null&&n.prestataires&&a(r=>({...r,prestataires:n.prestataires}))},[n]);const f=r=>{if(r.preventDefault(),!t.lot||!t.nom||!t.telephone)return;const l={lot:t.lot,nom:t.nom,telephone:t.telephone};a(o=>({...o,prestataires:[...o.prestataires,l],lot:"",nom:"",telephone:""})),i(!1)},g=()=>{t.prestataires.length!==0&&u("/fiche-controle/form",{name:t.name,date:t.date,type:t.type,prestataires:t.prestataires})},b=()=>{i(!0)},x=()=>{i(!1),a(r=>({...r,lot:"",nom:"",telephone:""}))};return s("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 py-10",children:[s("div",{className:"sm:flex sm:items-center mb-6",children:[s("div",{className:"sm:flex-auto",children:[e("h1",{className:"text-xl font-semibold text-gray-900",children:"Liste Prestataires"}),s("div",{className:"mt-4",children:[e("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Date:"}),e("input",{type:"date",value:t.date,onChange:r=>a("date",r.target.value),className:"shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm border-gray-300 rounded-md"})]})]}),e("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none",children:!d&&e("button",{type:"button",onClick:b,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Ajouter Prestataire"})})]}),t.prestataires.length>0&&!d&&e("div",{className:"mb-4",children:e("button",{type:"button",onClick:g,disabled:c,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:c?"Enregistrement...":"Enregistrer la fiche"})}),t.prestataires.length>0&&e("button",{type:"button",onClick:()=>{axios.post("/fiche-controle/download-prestataire-pdf",{name:t.name,date:t.date,prestataires:t.prestataires},{responseType:"blob"}).then(r=>{const l=window.URL.createObjectURL(new Blob([r.data])),o=document.createElement("a");o.href=l,o.setAttribute("download",`Liste_Prestataires_${t.date}.pdf`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(l)}).catch(r=>{console.error("Error downloading PDF:",r)})},className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Télécharger PDF"}),e("div",{className:"mt-8 flex flex-col",children:e("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:e("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:s("table",{className:"min-w-full divide-y divide-gray-300",children:[e("thead",{className:"bg-gray-50",children:s("tr",{children:[e("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"LOT"}),e("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Nom Prestataire"}),e("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"N Telephone"}),e("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:e("span",{className:"sr-only",children:"Actions"})})]})}),s("tbody",{className:"divide-y divide-gray-200 bg-white",children:[t.prestataires.map((r,l)=>s("tr",{children:[e("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:r.lot}),e("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:r.nom}),e("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:r.telephone})]},l)),d&&s("tr",{children:[e("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 sm:pl-6",children:e("input",{type:"text",value:t.lot,onChange:r=>a("lot",r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm",placeholder:"LOT"})}),e("td",{className:"whitespace-nowrap px-3 py-4",children:e("input",{type:"text",value:t.nom,onChange:r=>a("nom",r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm",placeholder:"Nom Prestataire"})}),e("td",{className:"whitespace-nowrap px-3 py-4",children:e("input",{type:"text",value:t.telephone,onChange:r=>a("telephone",r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm",placeholder:"N Telephone"})}),s("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:[e("button",{type:"button",onClick:f,className:"inline-flex mr-2 items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Ajouter"}),e("button",{type:"button",onClick:x,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Annuler"})]})]})]})]})})})})})]})}export{k as default};
