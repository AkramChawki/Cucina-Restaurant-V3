import{j as r,R as ce,r as p,a as i,q as de,f as O}from"./app-09bff3f3.js";import{c as $}from"./createLucideIcon-19e6cf10.js";import{C as ee}from"./circle-alert-af401501.js";import{C as ue}from"./calendar-7836ede5.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],me=$("ChevronsUpDown",ge);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],he=$("CircleCheckBig",pe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ye=$("CirclePlus",fe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ve=$("Save",be);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ne=$("Trash2",xe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ce=$("X",we),Se=({message:d,type:u="success",onClose:l})=>(p.useEffect(()=>{const k=setTimeout(()=>{l()},3e3);return()=>clearTimeout(k)},[l]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${u==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[r("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:u==="success"?r(he,{className:"w-5 h-5 text-green-600"}):r(ee,{className:"w-5 h-5 text-red-600"})}),r("div",{className:"ml-3 text-sm font-normal",children:d}),r("button",{onClick:l,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:r(Ce,{className:"w-5 h-5"})})]})),De=({toasts:d,removeToast:u})=>r("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:d.map(l=>r(Se,{message:l.message,type:l.type,onClose:()=>u(l.id)},l.id))}),ke=()=>{const[d,u]=ce.useState([]);return{toasts:d,addToast:(f,N="success")=>{const w=Date.now();u(a=>[...a,{id:w,message:f,type:N}])},removeToast:f=>{u(N=>N.filter(w=>w.id!==f))}}},Y={gastro:["Mozzarella Milka","Creme Fraîche","PERLA CERISE","Mozzarella cerise"],giada:["Mozzarella","Stracciatella","Buratta","Ricotta"],legume:["Roquette","EPINARD","Tomate cerise","Poivron Rouge","Poivron vert","CHAMPIGNON","CITRON","ORANGUE","CONCOMBRE","AIL","Basilic","Courgette","OIGNON"],boisson:["Coca","Coca Zero","Hawaei","Sprite","POMS","Citron","Tonic","Ouelmes","EAU"]},Me=["KG","250G","unite","L","Botte","paquet de 24 U","Pot de 1 kg"],q=d=>{if(!d)return"";try{const u=d instanceof Date?d:new Date(d),l=u.getTimezoneOffset()*6e4;return new Date(u.getTime()-l).toISOString().split("T")[0]}catch(u){return console.error("Error formatting date:",u),""}},L=d=>{switch(d){case"gastro":return"GASTRO";case"giada":return"GIADA";case"legume":return"Legume";case"boisson":return"COCA COLA";default:return""}},Fe=({value:d,onChange:u,disabled:l})=>{const[k,f]=p.useState(!1),N=p.useRef(null),w=new Date(d);p.useEffect(()=>{const m=c=>{N.current&&!N.current.contains(c.target)&&f(!1)};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[N]);const a=new Date().getFullYear(),I=Array.from({length:6},(m,c)=>a-c),g=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],j=m=>{const c=new Date(w.getFullYear(),m);u(c),f(!1)},v=m=>{const c=new Date(m,w.getMonth());u(c),f(!1)};return i("div",{className:"relative",ref:N,children:[i("button",{type:"button",onClick:()=>!l&&f(!k),className:`flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm ${l?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,disabled:l,children:[r(ue,{className:"w-4 h-4 mr-2 text-gray-500"}),i("span",{children:[g[w.getMonth()]," ",w.getFullYear()]}),r(me,{className:"w-4 h-4 ml-2 text-gray-500"})]}),k&&i("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-2 w-64",children:[i("div",{className:"mb-2",children:[r("div",{className:"font-medium text-gray-700 mb-1",children:"Mois"}),r("div",{className:"grid grid-cols-3 gap-1",children:g.map((m,c)=>r("button",{type:"button",className:`text-sm p-1 rounded ${w.getMonth()===c?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>j(c),children:m.substring(0,3)},m))})]}),i("div",{children:[r("div",{className:"font-medium text-gray-700 mb-1",children:"Année"}),r("div",{className:"grid grid-cols-3 gap-1",children:I.map(m=>r("button",{type:"button",className:`text-sm p-1 rounded ${w.getFullYear()===m?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>v(m),children:m},m))})]})]})]})};function $e({restaurant:d,currentMonth:u,existingEntries:l=[],types:k={},currentType:f=""}){const{auth:N,processing:w}=de().props,a=!!N.user.guest;console.log("Guest status:",N.user.guest,"isGuest:",a);const{toasts:I,addToast:g,removeToast:j}=ke(),[v,m]=p.useState(new Date(u.year,u.month-1)),[c,G]=p.useState(()=>(console.log("Setting initial selectedType:",f),String(f||""))),[h,C]=p.useState(!1),[S,M]=p.useState({}),P=p.useRef(!0),U=p.useRef(l),[te,K]=p.useState(null),[x,re]=p.useState({key:"date",direction:"ascending"});p.useEffect(()=>{if(console.log("existingEntries received:",l),console.log("existingEntries is array?",Array.isArray(l)),console.log("existingEntries length:",l.length),l&&l.length>0){console.log("Setting rows from existingEntries");const e=l.map((t,s)=>({id:Date.now()+s,fournisseur:t.fournisseur||L(t.type),designation:t.designation||"",quantity:t.quantity||"",price:t.price||"",unite:t.unite||"",date:q(t.date),type:t.type||c,total_ttc:parseFloat(t.total_ttc)||0,isNew:!1,isSaving:!1,hasChanges:!1,originalId:t.id}));D(e)}else(!y.length||y.length===1&&y[0].isNew)&&console.log("Keeping default row")},[l]),p.useEffect(()=>{console.log("currentType prop changed to:",f),f!==c&&(console.log("Updating selectedType state from prop"),G(String(f||"")))},[f]),p.useEffect(()=>{d&&(!l||l.length===0)&&O.get(route("bml.show",[d.slug]),{month:v.getMonth()+1,year:v.getFullYear(),type:c},{preserveScroll:!0,preserveState:!0,onFinish:()=>C(!1)})},[d]);const V=()=>({id:Date.now()+Math.floor(Math.random()*1e3),fournisseur:L(c),designation:"",quantity:"",price:"",unite:"",date:q(new Date),type:c,total_ttc:0,isNew:!0,isSaving:!1,hasChanges:!1}),[y,D]=p.useState([V()]),_=y.some(e=>e.hasChanges),se=e=>e.reduce((s,n)=>{const o=n.date;return o&&(s[o]||(s[o]={rows:[],total:0}),s[o].rows.push(n),s[o].total+=parseFloat(n.total_ttc)||0),s},{});p.useEffect(()=>{if(P.current){console.log("Initial render, skipping"),P.current=!1;return}console.log("Checking if entries changed");const e=JSON.stringify(U.current)!==JSON.stringify(l);if(console.log("Entries changed?",e),U.current=l,!e){console.log("No change in entries, skipping update");return}if(console.log("Entries changed, updating rows"),l&&l.length>0){const t=l.map((s,n)=>({id:Date.now()+n,fournisseur:s.fournisseur||L(s.type),designation:s.designation||"",quantity:s.quantity||"",price:s.price||"",unite:s.unite||"",date:q(s.date),type:s.type||c,total_ttc:parseFloat(s.total_ttc)||0,isNew:!1,isSaving:!1,hasChanges:!1,originalId:s.id}));console.log("Setting rows with formatted data",t),D(t)}else console.log("No entries or empty array, setting default row"),D([V()])},[l,c]);const E=[...y].sort((e,t)=>{if(!e[x.key]||!t[x.key])return 0;if(x.key==="date"){const o=new Date(e.date),b=new Date(t.date);return x.direction==="ascending"?o-b:b-o}const s=e[x.key].toString().toLowerCase(),n=t[x.key].toString().toLowerCase();return s<n?x.direction==="ascending"?-1:1:s>n?x.direction==="ascending"?1:-1:(console.log("Sorted rows count before render:",E.length),console.log("First sorted row:",E.length>0?E[0]:null),0)}),H=e=>{let t="ascending";x.key===e&&x.direction==="ascending"&&(t="descending"),re({key:e,direction:t})},J=e=>x.key!==e?null:r("span",{className:"ml-1",children:x.direction==="ascending"?"▲":"▼"}),B=(e,t)=>{const s=parseFloat(e)||0,n=parseFloat(t)||0;return(s*n).toFixed(2)},A=e=>{if(!e)return!1;const t=new Date(e);return t.getMonth()+1!==v.getMonth()+1||t.getFullYear()!==v.getFullYear()},X=()=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas ajouter de lignes.","warning");return}D(e=>[...e,V()])},ne=async e=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas supprimer de lignes.","warning");return}const t=y.find(s=>s.id===e);if(t){if(y.length<=1){g("Impossible de supprimer la seule ligne","warning");return}if(!t.isNew&&t.originalId){if(!confirm("Êtes-vous sûr de vouloir supprimer cette ligne?"))return;M(s=>({...s,[e]:!0}));try{O.post(route("bml.delete"),{id:t.originalId,restaurant_id:d.id},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:s=>{console.error("Delete error:",s),g("Erreur lors de la suppression","error"),M(n=>({...n,[e]:!1}))}})}catch(s){g("Erreur lors de la suppression","error"),console.error("Error deleting row:",s),M(n=>({...n,[e]:!1}))}}else D(s=>s.filter(n=>n.id!==e)),M(s=>{const n={...s};return delete n[e],n})}},Q=async e=>{if(a){g("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const t=y.find(s=>s.id===e);if(t){if(!t.date||!t.fournisseur||!t.designation||!t.quantity||!t.price||!t.unite){g("Veuillez remplir tous les champs obligatoires.","error");return}if(A(t.date)){const n=new Date(t.date).toLocaleDateString("fr-FR");if(!confirm(`Attention: La date sélectionnée (${n}) est en dehors du mois actuel. Cette entrée sera automatiquement placée dans le mois correspondant à sa date. Voulez-vous continuer?`))return}D(s=>s.map(n=>n.id===e?{...n,isSaving:!0}:n)),M(s=>({...s,[e]:!0}));try{const s=new Date(t.date),n={...t,date:q(s),type:c||t.type||"gastro",total_ttc:B(t.quantity,t.price)},o={restaurant_id:d.id,rows:[n],month:s.getMonth()+1,year:s.getFullYear(),type:c||"gastro",day_total:parseFloat(n.total_ttc).toFixed(2)};await O.post(route("bml.update-value"),o,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:b=>{console.error("Save error:",b),g("Erreur lors de l'enregistrement","error"),D(z=>z.map(R=>R.id===e?{...R,isSaving:!1}:R)),M(z=>({...z,[e]:!1}))}})}catch(s){console.error("Error saving row:",s),g("Erreur lors de l'enregistrement","error"),D(n=>n.map(o=>o.id===e?{...o,isSaving:!1}:o)),M(n=>({...n,[e]:!1}))}}},F=(e,t,s)=>{a||D(n=>n.map(o=>{if(o.id===e){const b={...o,[t]:s,hasChanges:!0};return t==="type"&&(b.fournisseur=L(s)),(t==="quantity"||t==="price")&&(b.total_ttc=B(t==="quantity"?s:o.quantity,t==="price"?s:o.price)),b}return o}))},ae=e=>{try{const t=e.target.value;if(console.log("Type changed to:",t),_&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;G(t),C(!0);const s=route("bml.filter",[d.slug]);console.log("Using filter endpoint:",s,"with type:",t),O.get(s,{month:v.getMonth()+1,year:v.getFullYear(),type:t},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{console.log("Filter successful",n),C(!1)},onError:n=>{console.error("Filter error:",n),C(!1),g("Erreur lors du chargement des données.","error")}})}catch(t){console.error("Error in handleTypeChange:",t),C(!1),g("Une erreur est survenue lors du changement de type.","error")}},oe=e=>{if(_&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;m(e),C(!0);const t=route("bml.filter",[d.slug]);console.log("Using filter endpoint for month change:",t),O.get(t,{month:e.getMonth()+1,year:e.getFullYear(),type:c},{preserveScroll:!0,preserveState:!0,onSuccess:s=>{console.log("Month filter successful",s),C(!1)},onError:s=>{console.error("Month filter error:",s),C(!1),g("Erreur lors du chargement des données.","error")}})},W=()=>{const e=se(y);return Object.entries(e).map(([t,s])=>({date:t,total:s.total.toFixed(2)})).sort((t,s)=>t.date.localeCompare(s.date))},ie=e=>{if(e.preventDefault(),a){g("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const t=y.filter(o=>o.hasChanges);if(t.length===0){g("Aucune modification à enregistrer.","info");return}if(!confirm(`Voulez-vous enregistrer ${t.length} ligne(s) modifiée(s)?`))return;const s=t.map(o=>{const b=new Date(o.date);return{...o,date:q(b),type:c||o.type||"gastro",total_ttc:B(o.quantity,o.price)}}),n={restaurant_id:d.id,rows:s,month:v.getMonth()+1,year:v.getFullYear(),type:c||"gastro",day_total:s.reduce((o,b)=>o+parseFloat(b.total_ttc),0).toFixed(2)};C(!0),O.post(route("bml.store"),n,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:o=>{console.error("Save error:",o),g("Erreur lors de l'enregistrement","error"),C(!1)}})},T=(e,t,s,n)=>{if(!a){if(e.key==="Enter"){e.preventDefault(),Q(t);return}if(e.key==="Tab"&&!e.shiftKey){const o=["date","fournisseur","designation","quantity","unite","price"];o.indexOf(s)===o.length-1&&(e.preventDefault(),n===y.length-1&&X(),setTimeout(()=>{const R=n+1;if(R<y.length){const le=y[R].id,Z=document.querySelector(`input[name="date-${le}"]`);Z&&Z.focus()}},0))}}};return i("div",{className:"p-4 sm:p-6",children:[a&&r("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg mb-4 p-3",children:i("div",{className:"flex items-center justify-center",children:[r(ee,{className:"h-5 w-5 text-yellow-600 mr-2"}),r("span",{className:"font-medium text-yellow-800",children:"Mode consultation uniquement. Vous ne pouvez pas modifier les données."})]})}),r("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[r("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[d.name," -"," ",v.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),r("div",{className:"relative",children:i("select",{value:c,onChange:ae,className:`block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 py-2 pl-3 pr-10 text-base bg-gray-100 cursor-not-allowed" : ""
                                }`,disabled:h,children:[r("option",{value:"",children:"Tous les types"}),Object.entries(k).map(([e,t])=>r("option",{value:t,children:e},t))]})})]}),r("div",{className:"flex-shrink-0",children:r(Fe,{value:v,onChange:oe,disabled:h})})]})}),r("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:i("form",{onSubmit:ie,children:[h&&r("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i("div",{className:"text-center",children:[r("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),r("p",{className:"mt-2 text-gray-600",children:"Chargement en cours..."})]})}),r("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[r("thead",{className:"bg-gray-50",children:i("tr",{children:[r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>H("date"),children:i("div",{className:"flex items-center",children:["Date ",J("date")]})}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Fournisseur"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>H("designation"),children:i("div",{className:"flex items-center",children:["Designation"," ",J("designation")]})}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Quantité"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Unité"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Prix"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Total TTC"}),r("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Actions"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[E.map((e,t)=>{var s;return i("tr",{className:`hover:bg-gray-50 transition-colors duration-150 ${e.hasChanges?"bg-blue-50":""}`,children:[i("td",{className:`px-4 py-2 ${A(e.date)?"bg-yellow-50":""}`,children:[i("div",{className:"relative",children:[r("input",{name:`date-${e.id}`,type:"date",value:e.date||"",onChange:n=>F(e.id,"date",n.target.value),onKeyDown:n=>T(n,e.id,"date",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${A(e.date)?"border-yellow-400 bg-yellow-50":""} ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:h||S[e.id]||a,readOnly:a,max:q(new Date)}),A(e.date)&&r("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:r("svg",{className:"h-5 w-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:r("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),A(e.date)&&r("div",{className:"text-xs text-yellow-600 mt-1",children:"Date hors du mois sélectionné"})]}),r("td",{className:"px-4 py-2",children:r("input",{type:"text",value:e.fournisseur,onChange:n=>F(e.id,"fournisseur",n.target.value),onKeyDown:n=>T(n,e.id,"fournisseur",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:!0,readOnly:!0})}),i("td",{className:"px-4 py-2 relative",children:[r("input",{id:`designation-${e.id}`,type:"text",value:e.designation,onChange:n=>F(e.id,"designation",n.target.value),onKeyDown:n=>T(n,e.id,"designation",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:h||S[e.id]||a,readOnly:a,autoComplete:"off",onFocus:()=>!a&&K(e.id),onBlur:()=>{setTimeout(()=>K(null),200)}}),!h&&!a&&te===e.id&&i("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-md z-50 max-h-40 overflow-y-auto",children:[(s=Y[c])==null?void 0:s.map((n,o)=>r("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onMouseDown:b=>{b.preventDefault(),F(e.id,"designation",n)},children:n},o)),(!Y[c]||Y[c].length===0)&&r("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Aucune suggestion"})]})]}),r("td",{className:"px-4 py-2",children:r("input",{type:"number",value:e.quantity,onChange:n=>F(e.id,"quantity",n.target.value),onKeyDown:n=>T(n,e.id,"quantity",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:h||S[e.id]||a,readOnly:a})}),r("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[r("input",{type:"text",list:"unite-options",value:e.unite,onChange:n=>F(e.id,"unite",n.target.value),onKeyDown:n=>T(n,e.id,"unite",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:h||S[e.id]||a,readOnly:a}),r("datalist",{id:"unite-options",children:Me.map((n,o)=>r("option",{value:n},o))})]})}),r("td",{className:"px-4 py-2",children:r("input",{type:"number",value:e.price,onChange:n=>F(e.id,"price",n.target.value),onKeyDown:n=>T(n,e.id,"price",t),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:h||S[e.id]||a,readOnly:a})}),r("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900 font-medium",children:[parseFloat(e.total_ttc).toFixed(2)," ","MAD"]})}),r("td",{className:"px-4 py-2",children:i("div",{className:"flex space-x-2",children:[r("button",{type:"button",onClick:()=>Q(e.id),className:`text-blue-600 hover:text-blue-800 ${!e.hasChanges||a?"opacity-50 cursor-not-allowed":""}`,disabled:h||!e.hasChanges||S[e.id]||a,title:a?"Mode consultation uniquement":"Enregistrer cette ligne",children:S[e.id]?r("div",{className:"h-5 w-5 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"}):r(ve,{className:"h-5 w-5"})}),r("button",{type:"button",onClick:()=>ne(e.id),className:`text-red-600 hover:text-red-800 ${a||y.length<=1||S[e.id]?"opacity-50 cursor-not-allowed":""}`,disabled:h||y.length<=1||S[e.id]||a,title:a?"Mode consultation uniquement":"Supprimer cette ligne",children:r(Ne,{className:"h-5 w-5"})})]})})]},e.id)}),r("tr",{className:"bg-gray-50",children:i("td",{colSpan:"8",className:"px-4 py-3",children:[r("div",{className:"font-semibold text-gray-900 mb-2",children:"Totaux par jour"}),r("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:W().map(e=>i("div",{className:"flex justify-between items-center bg-white p-2 rounded-md shadow-sm",children:[r("span",{className:"text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),i("span",{className:"font-medium text-gray-900",children:[parseFloat(e.total).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]},e.date))}),i("div",{className:"mt-3 flex justify-end items-center border-t pt-2",children:[r("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Total du mois:"}),i("span",{className:"text-lg font-bold text-gray-900",children:[W().reduce((e,t)=>e+parseFloat(t.total),0).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]})]})})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:X,className:`inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ${h||a?"opacity-50 cursor-not-allowed":""}`,disabled:h||a,title:a?"Mode consultation uniquement":"Ajouter une ligne",children:[r(ye,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),r("button",{type:"submit",className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${!_||a||h?"opacity-50 cursor-not-allowed":""}`,disabled:h||!_||a,title:a?"Mode consultation uniquement":"Enregistrer toutes les modifications",children:h?"Enregistrement...":"Enregistrer tout"})]})]})}),r(De,{toasts:I,removeToast:j})]})}export{$e as default};
