import{j as t,i as L,r as f,a as n,f as N}from"./app-db1ca752.js";import{c as v}from"./createLucideIcon-01ad44e0.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],R=v("CircleAlert",A);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],B=v("CircleCheckBig",$);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],O=v("CirclePlus",I);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],P=v("Trash2",Y);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],E=v("X",z),U=({message:m,type:a="success",onClose:s})=>(f.useEffect(()=>{const g=setTimeout(()=>{s()},3e3);return()=>clearTimeout(g)},[s]),n("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${a==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:a==="success"?t(B,{className:"w-5 h-5 text-green-600"}):t(R,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:m}),t("button",{onClick:s,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(E,{className:"w-5 h-5"})})]})),V=({toasts:m,removeToast:a})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:m.map(s=>t(U,{message:s.message,type:s.type,onClose:()=>a(s.id)},s.id))}),X=()=>{const[m,a]=L.useState([]);return{toasts:m,addToast:(i,h="success")=>{const y=Date.now();a(b=>[...b,{id:y,message:i,type:h}])},removeToast:i=>{a(h=>h.filter(y=>y.id!==i))}}};function G({title:m,routeName:a,restaurant:s,currentMonth:g,existingEntries:i,types:h={Achat:"achat",Livraison:"livraison",Stock:"stock",Autre:"autre"},currentType:y}){const{toasts:b,addToast:w,removeToast:T}=X(),[c,C]=f.useState(new Date(g.year,g.month-1)),[o,S]=f.useState(y||""),[l,x]=f.useState([{id:1,fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:o,total_ttc:0}]);f.useEffect(()=>{if(i&&i.length>0){const r=i.map((e,d)=>({id:d+1,fournisseur:e.fournisseur,designation:e.designation,quantity:e.quantity,price:e.price,unite:e.unite,date:e.date,type:e.type,total_ttc:e.quantity*e.price}));x(r)}else x([{id:1,fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:o,total_ttc:0}])},[i,c,o]);const q=(r,e)=>{const d=parseFloat(r)||0,u=parseFloat(e)||0;return(d*u).toFixed(2)},_=()=>{const r={id:l.length+1,fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:new Date().toISOString().split("T")[0],type:o,total_ttc:0};x([...l,r])},M=r=>{l.length>1&&x(l.filter(e=>e.id!==r))},p=(r,e,d)=>{x(l.map(u=>{if(u.id===r){const k={...u,[e]:d};return(e==="quantity"||e==="price")&&(k.total_ttc=q(e==="quantity"?d:u.quantity,e==="price"?d:u.price)),k}return u}))},D=r=>{const e=r.target.value;S(e),N.get(route("BL.show",[s.slug]),{month:c.getMonth()+1,year:c.getFullYear(),type:e},{preserveScroll:!0,preserveState:!0})},F=r=>{const e=new Date(r.target.value);C(e),N.get(route("BL.show",[s.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:o},{preserveScroll:!0,preserveState:!0})},j=r=>{r.preventDefault(),N.post(route(a),{restaurant_id:s.id,rows:l.map(e=>({...e,type:o||e.type})),month:c.getMonth()+1,year:c.getFullYear()},{preserveScroll:!0,onSuccess:()=>{w("Les données ont été enregistrées avec succès.","success")},onError:e=>{w("Une erreur est survenue lors de l'enregistrement.","error")}})};return n("div",{className:"p-4 sm:p-6",children:[t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:n("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[n("div",{className:"flex-1 flex items-center gap-4",children:[n("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),n("p",{className:"mt-1 text-sm text-gray-600",children:[s.name," - ",c.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),n("select",{value:o,onChange:D,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[t("option",{value:"",children:"Tous les types"}),Object.entries(h).map(([r,e])=>t("option",{value:e,children:r},e))]})]}),t("div",{className:"flex-shrink-0",children:t("input",{type:"month",value:`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,onChange:F,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),t("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:n("form",{onSubmit:j,children:[t("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:n("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),t("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(r=>n("tr",{children:[t("td",{className:"px-4 py-2",children:t("input",{type:"date",value:r.date,onChange:e=>p(r.id,"date",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:r.fournisseur,onChange:e=>p(r.id,"fournisseur",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:r.designation,onChange:e=>p(r.id,"designation",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:r.quantity,onChange:e=>p(r.id,"quantity",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:r.unite,onChange:e=>p(r.id,"unite",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:r.price,onChange:e=>p(r.id,"price",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:n("div",{className:"text-sm text-gray-900",children:[r.total_ttc,"€"]})}),t("td",{className:"px-4 py-2",children:t("button",{type:"button",onClick:()=>M(r.id),className:"text-red-600 hover:text-red-800",children:t(P,{className:"h-5 w-5"})})})]},r.id))})]})}),n("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[n("button",{type:"button",onClick:_,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[t(O,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),t(V,{toasts:b,removeToast:T})]})}export{G as default};
