import{j as t,i as L,r as v,a as n,f as k}from"./app-d8dfbe38.js";import{c as N}from"./createLucideIcon-f39386dd.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],$=N("CircleAlert",R);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],B=N("CircleCheckBig",Y);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],O=N("CirclePlus",z);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],G=N("Trash2",P);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],U=N("X",I),V=({message:i,type:c="success",onClose:o})=>(v.useEffect(()=>{const x=setTimeout(()=>{o()},3e3);return()=>clearTimeout(x)},[o]),n("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${c==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:c==="success"?t(B,{className:"w-5 h-5 text-green-600"}):t($,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:i}),t("button",{onClick:o,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(U,{className:"w-5 h-5"})})]})),X=({toasts:i,removeToast:c})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:i.map(o=>t(V,{message:o.message,type:o.type,onClose:()=>c(o.id)},o.id))}),H=()=>{const[i,c]=L.useState([]);return{toasts:i,addToast:(f,y="success")=>{const p=Date.now();c(T=>[...T,{id:p,message:f,type:y}])},removeToast:f=>{c(y=>y.filter(p=>p.id!==f))}}},Q={Gastro:"gastro",Giada:"giada",Legume:"legume",Boisson:"boisson"},b=i=>{if(!i)return"";try{const c=i instanceof Date?i:new Date(i),o=c.getTimezoneOffset()*6e4;return new Date(c.getTime()-o).toISOString().split("T")[0]}catch(c){return console.error("Error formatting date:",c),""}};function W({restaurant:i,currentMonth:c,existingEntries:o=[],types:x=Q,currentType:f=""}){const{toasts:y,addToast:p,removeToast:T}=H(),[d,S]=v.useState(new Date(c.year,c.month-1)),[u,q]=v.useState(f),w=()=>({id:Date.now(),fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:b(new Date),type:u,total_ttc:0}),[D,m]=v.useState([w()]);v.useEffect(()=>{if(o&&o.length>0){const s=o.map((e,a)=>({id:Date.now()+a,fournisseur:e.fournisseur||"",designation:e.designation||"",quantity:e.quantity||"",price:e.price||"",unite:e.unite||"",date:b(e.date),type:e.type||u,total_ttc:e.total_ttc||0}));m(s)}},[o,u]);const C=(s,e)=>{const a=parseFloat(s)||0,l=parseFloat(e)||0;return(a*l).toFixed(2)},M=()=>{m(s=>[...s,w()])},F=s=>{m(e=>e.length<=1?e:e.filter(a=>a.id!==s))},g=(s,e,a)=>{m(l=>l.map(r=>{if(r.id===s){const h={...r,[e]:a};return(e==="quantity"||e==="price")&&(h.total_ttc=C(e==="quantity"?a:r.quantity,e==="price"?a:r.price)),h}return r}))},j=s=>{const e=s.target.value;q(e),m([w()]),k.get(route("bml.show",[i.slug]),{month:d.getMonth()+1,year:d.getFullYear(),type:e},{preserveScroll:!0,preserveState:!0,onSuccess:a=>{if(a.props.existingEntries.length>0){const l=a.props.existingEntries.map((r,h)=>({id:Date.now()+h,fournisseur:r.fournisseur||"",designation:r.designation||"",quantity:r.quantity||"",price:r.price||"",unite:r.unite||"",date:b(r.date||new Date),type:r.type||e,total_ttc:r.total_ttc||0}));m(l)}}})},E=s=>{const e=new Date(s.target.value);S(e),m([w()]),k.get(route("bml.show",[i.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:u},{preserveScroll:!0,preserveState:!0,onSuccess:a=>{if(a.props.existingEntries.length>0){const l=a.props.existingEntries.map((r,h)=>({id:Date.now()+h,fournisseur:r.fournisseur||"",designation:r.designation||"",quantity:r.quantity||"",price:r.price||"",unite:r.unite||"",date:b(r.date||new Date),type:r.type||u,total_ttc:r.total_ttc||0}));m(l)}}})},_=()=>D.reduce((s,e)=>s+(parseFloat(e.total_ttc)||0),0).toFixed(2),A=s=>{s.preventDefault();const e=_(),a={restaurant_id:i.id,rows:D.map(l=>({...l,date:b(l.date),type:u||l.type,total_ttc:C(l.quantity,l.price)})),month:d.getMonth()+1,year:d.getFullYear(),type:u,day_total:e};k.post(route("bml.update-value"),a,{preserveScroll:!0,onSuccess:()=>{p("Les données ont été enregistrées avec succès.","success"),k.get(route("bml.show",[i.slug]),{month:d.getMonth()+1,year:d.getFullYear(),type:u},{preserveScroll:!0,preserveState:!0})},onError:l=>{p("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",l)}})};return n("div",{className:"p-4 sm:p-6",children:[t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:n("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[n("div",{className:"flex-1 flex items-center gap-4",children:[n("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),n("p",{className:"mt-1 text-sm text-gray-600",children:[i.name," - ",d.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),n("select",{value:u,onChange:j,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[t("option",{value:"",children:"Tous les types"}),Object.entries(x).map(([s,e])=>t("option",{value:e,children:s},e))]})]}),t("div",{className:"flex-shrink-0",children:t("input",{type:"month",value:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`,onChange:E,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),t("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:n("form",{onSubmit:A,children:[t("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:n("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),n("tbody",{className:"bg-white divide-y divide-gray-200",children:[D.map(s=>n("tr",{children:[t("td",{className:"px-4 py-2",children:t("input",{type:"date",value:s.date||"",onChange:e=>g(s.id,"date",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.fournisseur,onChange:e=>g(s.id,"fournisseur",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.designation,onChange:e=>g(s.id,"designation",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.quantity,onChange:e=>g(s.id,"quantity",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.unite,onChange:e=>g(s.id,"unite",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.price,onChange:e=>g(s.id,"price",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:n("div",{className:"text-sm text-gray-900",children:[s.total_ttc,"MAD"]})}),t("td",{className:"px-4 py-2",children:t("button",{type:"button",onClick:()=>F(s.id),className:"text-red-600 hover:text-red-800",children:t(G,{className:"h-5 w-5"})})})]},s.id)),n("tr",{className:"bg-gray-50 font-semibold",children:[t("td",{colSpan:"6",className:"px-4 py-2 text-right",children:"Total TTC"}),n("td",{className:"px-4 py-2 text-gray-900",children:[_(),"MAD"]}),t("td",{})]})]})]})}),n("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[n("button",{type:"button",onClick:M,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[t(O,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),t(X,{toasts:y,removeToast:T})]})}export{W as default};
