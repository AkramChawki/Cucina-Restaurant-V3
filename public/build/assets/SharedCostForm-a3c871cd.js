import{q as H,r as _,a as n,j as a,f as D}from"./app-0052ea2c.js";function Y({title:M,routeName:S,restaurant:u,products:g,currentMonth:f}){const{auth:p,processing:z}=H().props,l=!!p.user.guest;console.log("Guest status:",p.user.guest,"isGuest:",l);const[o,j]=_.useState(new Date(f.year,f.month-1)),c=Array.from({length:new Date(o.getFullYear(),o.getMonth()+1,0).getDate()},(e,t)=>t+1),T=e=>{const t=new Date(e.target.value);j(t),D.get(window.location.pathname,{month:t.getMonth()+1,year:t.getFullYear()},{preserveState:!0,preserveScroll:!0,only:["products","currentMonth"]})},h=(e,t)=>{const r=parseFloat(s(e,t,"morning"))||0,i=parseFloat(s(e,t,"afternoon"))||0;return(r+i)*(e.prix||0)},v=e=>g.reduce((t,r)=>t+h(r,e),0),k=()=>c.reduce((e,t)=>e+v(t),0),C=e=>c.reduce((t,r)=>{const i=parseFloat(s(e,r,"morning"))||0,d=parseFloat(s(e,r,"afternoon"))||0;return t+i+d},0),w=(e,t,r,i)=>{if(l)return;const d=r==="morning"?parseFloat(i)||0:parseFloat(s(e,t,"morning"))||0,y=r==="afternoon"?parseFloat(i)||0:parseFloat(s(e,t,"afternoon"))||0,N=(d+y)*(e.prix||0);let m={...e.values||{}};m[t]||(m[t]={morning:0,afternoon:0,total:0}),m[t]={morning:d,afternoon:y,total:N};let x=0;g.forEach(F=>{F.id===e.id?x+=N:x+=h(F,t)}),D.post(route(S),{restaurant_id:u.id,product_id:e.id,day:t,month:o.getMonth()+1,year:o.getFullYear(),period:r,value:i||0,daily_data:m[t],day_total:x},{preserveScroll:!0,preserveState:!0})},b=e=>{e.target.blur()},s=(e,t,r)=>!e.values||!e.values[t]?"":e.values[t][r]||"";return n("div",{className:"flex flex-col h-full",children:[z&&a("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a("div",{className:"bg-white p-4 rounded-lg",children:"Loading..."})}),l&&a("div",{className:"bg-yellow-50 border-b border-yellow-200 p-3",children:n("div",{className:"flex items-center justify-center",children:[a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-600 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:a("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),a("span",{className:"font-medium text-yellow-800",children:"Mode consultation uniquement. Vous ne pouvez pas modifier les données."})]})}),n("div",{className:"bg-white p-4 border-b shadow-sm",children:[n("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 max-w-7xl mx-auto",children:[n("div",{children:[a("h1",{className:"text-xl font-semibold text-gray-900",children:M}),n("p",{className:"text-sm text-gray-600",children:[u.name," - ",o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),a("input",{type:"month",value:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,onChange:T,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500'}"})]}),a("div",{className:"mt-4 flex justify-center",children:n("div",{className:"bg-green-50 border border-green-200 rounded-lg px-6 py-3 shadow-sm",children:[a("h2",{className:"text-sm font-medium text-green-700 text-center",children:"Total du Mois"}),n("p",{className:"text-2xl font-bold text-green-800 text-center",children:[k().toFixed(2),"DH"]})]})})]}),a("div",{className:"sm:hidden bg-blue-50 p-2 text-center text-xs text-blue-700",children:"Swipe horizontally to see more days →"}),a("div",{className:"flex-1 overflow-hidden",children:a("div",{className:"h-full overflow-y-auto",children:a("div",{className:"overflow-x-auto pb-4 min-w-full",children:n("table",{className:"w-full border-collapse min-w-max",children:[a("thead",{className:"bg-gray-50 sticky top-0 z-20",children:n("tr",{children:[a("th",{className:"sticky left-0 z-30 bg-gray-50 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider max-w-[130px] sm:max-w-none px-2 sm:px-6",children:"Produit"}),c.map(e=>n("th",{className:"px-3 py-3 text-center border-x min-w-[90px]",children:[a("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:e}),n("div",{className:"text-sm font-semibold text-green-600",children:[v(e).toFixed(2),"DH"]}),n("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[a("div",{className:"text-xs text-gray-500",children:"Matin"}),a("div",{className:"text-xs text-gray-500",children:"Midi"})]})]},e))]})}),a("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>n("tr",{className:"hover:bg-gray-50",children:[a("td",{className:"sticky left-0 bg-white border-r whitespace-nowrap z-20 hover:bg-gray-50 max-w-[140px] sm:max-w-none px-2 sm:px-6 py-2 sm:py-4",children:n("div",{className:"flex items-center gap-1 sm:gap-3",children:[a("img",{src:`https://admin.cucinanapoli.com/storage/${e.image}`,alt:e.designation,className:"h-8 w-8 sm:h-12 sm:w-12 object-cover rounded-md flex-shrink-0"}),n("div",{className:"flex flex-col min-w-0",children:[a("span",{className:"text-sm font-medium text-gray-900 truncate",children:e.designation}),n("span",{className:"text-xs text-gray-500 truncate",children:[e.prix,"DH/",e.unite]}),n("div",{className:"mt-1 text-green-700 text-xs px-2 py-1 rounded-md inline-flex items-center",children:[a("span",{className:"font-semibold",children:"Total: "}),a("span",{className:"ml-1",children:C(e).toFixed(2)})]})]})]})}),c.map(t=>a("td",{className:"px-1 py-2 border-x min-w-[90px]",children:n("div",{className:"flex flex-col gap-1",children:[n("div",{className:"grid grid-cols-2 gap-1",children:[a("input",{type:"number",className:`w-full border-gray-300 rounded-sm ${l?"bg-gray-100 cursor-not-allowed":"focus:ring-green-500 focus:border-green-500"} text-sm p-1`,value:s(e,t,"morning"),onChange:r=>w(e,t,"morning",r.target.value),onWheel:b,step:"0.01",min:"0",placeholder:"0",disabled:l,readOnly:l}),a("input",{type:"number",className:`w-full border-gray-300 rounded-sm ${l?"bg-gray-100 cursor-not-allowed":"focus:ring-green-500 focus:border-green-500"} text-sm p-1`,value:s(e,t,"afternoon"),onChange:r=>w(e,t,"afternoon",r.target.value),onWheel:b,step:"0.01",min:"0",placeholder:"0",disabled:l,readOnly:l})]}),n("div",{className:"text-xs text-right text-gray-600 pr-1",children:[h(e,t).toFixed(2),"DH"]})]})},t))]},e.id))})]})})})})]})}export{Y as default};
