import{r as m,q as T,a as r,j as a,f as M}from"./app-693a7c8d.js";function W({title:S,routeName:C,restaurant:p,products:h,currentMonth:v}){const[o,k]=m.useState(new Date(v.year,v.month-1)),[s,$]=m.useState([]),[l,x]=m.useState(0),{processing:j}=T().props,i=Array.from({length:new Date(o.getFullYear(),o.getMonth()+1,0).getDate()},(e,t)=>t+1);m.useEffect(()=>{const e=()=>{const t=window.innerWidth;let n=3;t>=1280?n=10:t>=1024?n=7:t>=640&&(n=5),z(n)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[i,l]);const z=e=>{const t=Math.max(0,i.length-e),n=Math.min(l,t),c=Math.min(n+e,i.length);$(i.slice(n,c))},I=()=>{l>0&&x(Math.max(0,l-s.length))},E=()=>{l+s.length<i.length&&x(l+s.length)},_=e=>{const t=new Date(e.target.value);k(t),x(0),M.get(window.location.pathname,{month:t.getMonth()+1,year:t.getFullYear()},{preserveState:!0,preserveScroll:!0,only:["products","currentMonth"]})},u=(e,t)=>{const n=parseFloat(d(e,t,"morning"))||0,c=parseFloat(d(e,t,"afternoon"))||0;return(n+c)*(e.prix||0)},L=e=>h.reduce((t,n)=>t+u(n,e),0),y=(e,t,n,c)=>{const w=n==="morning"?parseFloat(c)||0:parseFloat(d(e,t,"morning"))||0,N=n==="afternoon"?parseFloat(c)||0:parseFloat(d(e,t,"afternoon"))||0,D=(w+N)*(e.prix||0);let g={...e.values||{}};g[t]||(g[t]={morning:0,afternoon:0,total:0}),g[t]={morning:w,afternoon:N,total:D};let f=0;h.forEach(F=>{F.id===e.id?f+=D:f+=u(F,t)}),M.post(route(C),{restaurant_id:p.id,product_id:e.id,day:t,month:o.getMonth()+1,year:o.getFullYear(),period:n,value:c||0,daily_data:g[t],day_total:f},{preserveScroll:!0,preserveState:!0})},b=e=>{e.target.blur()},d=(e,t,n)=>!e.values||!e.values[t]?"":e.values[t][n]||"",P=()=>{if(s.length===0)return"";const e=s[0],t=s[s.length-1];return`${e}-${t} / ${i.length}`};return r("div",{className:"flex flex-col h-full",children:[j&&a("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a("div",{className:"bg-white p-4 rounded-lg",children:"Loading..."})}),a("div",{className:"bg-white p-4 border-b shadow-sm",children:r("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 max-w-7xl mx-auto",children:[r("div",{children:[a("h1",{className:"text-xl font-semibold text-gray-900",children:S}),r("p",{className:"text-sm text-gray-600",children:[p.name," - ",o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),a("input",{type:"month",value:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,onChange:_,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})]})}),r("div",{className:"bg-gray-50 px-4 py-2 border-b flex items-center justify-between",children:[a("button",{onClick:I,disabled:l===0,className:`px-3 py-1 rounded-md ${l===0?"text-gray-400":"text-green-600 hover:bg-green-50"}`,children:"< Previous"}),r("span",{className:"text-sm font-medium",children:["Days ",P()]}),a("button",{onClick:E,disabled:l+s.length>=i.length,className:`px-3 py-1 rounded-md ${l+s.length>=i.length?"text-gray-400":"text-green-600 hover:bg-green-50"}`,children:"Next >"})]}),a("div",{className:"flex-1 overflow-hidden",children:a("div",{className:"overflow-x-auto overflow-y-auto h-full",children:r("table",{className:"w-full border-collapse",children:[a("thead",{className:"bg-gray-50 sticky top-0 z-20",children:r("tr",{children:[a("th",{className:"sticky left-0 z-30 bg-gray-50 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3 sm:w-1/4 md:w-1/5",children:"Produit"}),s.map(e=>r("th",{className:"px-3 py-3 text-center border-x",children:[a("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:e}),r("div",{className:"text-sm font-semibold text-green-600",children:[L(e).toFixed(2),"DH"]}),r("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[a("div",{className:"text-xs text-gray-500",children:"Matin"}),a("div",{className:"text-xs text-gray-500",children:"Midi"})]})]},e))]})}),a("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(e=>r("tr",{className:"hover:bg-gray-50",children:[a("td",{className:"sticky left-0 bg-white border-r px-4 py-4 whitespace-nowrap z-20 hover:bg-gray-50",children:r("div",{className:"flex items-center gap-3",children:[a("img",{src:`https://admin.cucinanapoli.com/storage/${e.image}`,alt:e.designation,className:"h-10 w-10 object-cover rounded-md"}),r("div",{className:"flex flex-col",children:[a("span",{className:"text-sm font-medium text-gray-900",children:e.designation}),r("span",{className:"text-xs text-gray-500",children:[e.prix,"DH/",e.unite]})]})]})}),s.map(t=>a("td",{className:"px-1 py-2 border-x",children:r("div",{className:"flex flex-col gap-1",children:[r("div",{className:"grid grid-cols-2 gap-1",children:[a("input",{type:"number",className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm p-1",value:d(e,t,"morning"),onChange:n=>y(e,t,"morning",n.target.value),onWheel:b,step:"0.01",min:"0",placeholder:"0"}),a("input",{type:"number",className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm p-1",value:d(e,t,"afternoon"),onChange:n=>y(e,t,"afternoon",n.target.value),onWheel:b,step:"0.01",min:"0",placeholder:"0"})]}),r("div",{className:"text-xs text-right text-gray-600 pr-1",children:[u(e,t).toFixed(2),"DH"]})]})},t))]},e.id))})]})})})]})}export{W as default};
