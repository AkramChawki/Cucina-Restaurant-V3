import{j as t,R as ce,r as f,a as i,q as de,f as $}from"./app-0052ea2c.js";import{c as T}from"./createLucideIcon-1906d595.js";import{C as ue}from"./calendar-26480ae9.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],ge=T("ChevronsUpDown",me);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],W=T("CircleAlert",pe);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],fe=T("CircleCheckBig",he);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],be=T("CirclePlus",ye);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],xe=T("Save",ve);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],we=T("Trash2",Ne);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],De=T("X",Ce),ke=({message:d,type:m="success",onClose:l})=>(f.useEffect(()=>{const k=setTimeout(()=>{l()},3e3);return()=>clearTimeout(k)},[l]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${m==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:m==="success"?t(fe,{className:"w-5 h-5 text-green-600"}):t(W,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:d}),t("button",{onClick:l,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(De,{className:"w-5 h-5"})})]})),Se=({toasts:d,removeToast:m})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:d.map(l=>t(ke,{message:l.message,type:l.type,onClose:()=>m(l.id)},l.id))}),Me=()=>{const[d,m]=ce.useState([]);return{toasts:d,addToast:(N,v="success")=>{const x=Date.now();m(a=>[...a,{id:x,message:N,type:v}])},removeToast:N=>{m(v=>v.filter(x=>x.id!==N))}}},j={gastro:["Mozzarella Milka","Creme Fraîche","PERLA CERISE","Mozzarella cerise"],giada:["Mozzarella","Stracciatella","Buratta","Ricotta"],legume:["Roquette","EPINARD","Tomate cerise","Poivron Rouge","Poivron vert","CHAMPIGNON","CITRON","ORANGUE","CONCOMBRE","AIL","Basilic","Courgette","OIGNON"],boisson:["Coca","Coca Zero","Hawaei","Sprite","POMS","Citron","Tonic","Ouelmes","EAU"]},Fe=["KG","250G","unite","L","Botte","paquet de 24 U","Pot de 1 kg"],_=d=>{if(!d)return"";try{const m=d instanceof Date?d:new Date(d),l=m.getTimezoneOffset()*6e4;return new Date(m.getTime()-l).toISOString().split("T")[0]}catch(m){return console.error("Error formatting date:",m),""}},B=d=>{switch(d){case"gastro":return"GASTRO";case"giada":return"GIADA";case"legume":return"Legume";case"boisson":return"COCA COLA";default:return""}},Te=({value:d,onChange:m,disabled:l})=>{const[k,N]=f.useState(!1),v=f.useRef(null),x=new Date(d);f.useEffect(()=>{const g=c=>{v.current&&!v.current.contains(c.target)&&N(!1)};return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[v]);const a=new Date().getFullYear(),E=Array.from({length:6},(g,c)=>a-c),u=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],L=g=>{const c=new Date(x.getFullYear(),g);m(c),N(!1)},w=g=>{const c=new Date(g,x.getMonth());m(c),N(!1)};return i("div",{className:"relative",ref:v,children:[i("button",{type:"button",onClick:()=>!l&&N(!k),className:`flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm ${l?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,disabled:l,children:[t(ue,{className:"w-4 h-4 mr-2 text-gray-500"}),i("span",{children:[u[x.getMonth()]," ",x.getFullYear()]}),t(ge,{className:"w-4 h-4 ml-2 text-gray-500"})]}),k&&i("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-2 w-64",children:[i("div",{className:"mb-2",children:[t("div",{className:"font-medium text-gray-700 mb-1",children:"Mois"}),t("div",{className:"grid grid-cols-3 gap-1",children:u.map((g,c)=>t("button",{type:"button",className:`text-sm p-1 rounded ${x.getMonth()===c?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>L(c),children:g.substring(0,3)},g))})]}),i("div",{children:[t("div",{className:"font-medium text-gray-700 mb-1",children:"Année"}),t("div",{className:"grid grid-cols-3 gap-1",children:E.map(g=>t("button",{type:"button",className:`text-sm p-1 rounded ${x.getFullYear()===g?"bg-green-500 text-white":"hover:bg-gray-100"}`,onClick:()=>w(g),children:g},g))})]})]})]})};function $e({restaurant:d,currentMonth:m,existingEntries:l=[],types:k={},currentType:N=""}){const{auth:v,processing:x}=de().props,a=!!v.user.guest;console.log("Guest status:",v.user.guest,"isGuest:",a);const{toasts:E,addToast:u,removeToast:L}=Me(),[w,g]=f.useState(new Date(m.year,m.month-1)),[c,Z]=f.useState(N),[p,C]=f.useState(!1),[D,M]=f.useState({}),P=f.useRef(!0),Y=f.useRef(l),[ee,G]=f.useState(null),[y,te]=f.useState({key:"date",direction:"ascending"}),V=()=>({id:Date.now()+Math.floor(Math.random()*1e3),fournisseur:B(c),designation:"",quantity:"",price:"",unite:"",date:_(new Date),type:c,total_ttc:0,isNew:!0,isSaving:!1,hasChanges:!1}),[b,S]=f.useState([V()]),z=b.some(e=>e.hasChanges),re=e=>e.reduce((s,r)=>{const o=r.date;return o&&(s[o]||(s[o]={rows:[],total:0}),s[o].rows.push(r),s[o].total+=parseFloat(r.total_ttc)||0),s},{});f.useEffect(()=>{if(P.current){P.current=!1;return}const e=JSON.stringify(Y.current)!==JSON.stringify(l);if(Y.current=l,!!e)if(l&&l.length>0){const n=l.map((s,r)=>({id:Date.now()+r,fournisseur:s.fournisseur||B(s.type),designation:s.designation||"",quantity:s.quantity||"",price:s.price||"",unite:s.unite||"",date:_(s.date),type:s.type||c,total_ttc:parseFloat(s.total_ttc)||0,isNew:!1,isSaving:!1,hasChanges:!1,originalId:s.id}));S(n)}else S([V()])},[l]);const ne=[...b].sort((e,n)=>{if(!e[y.key]||!n[y.key])return 0;if(y.key==="date"){const o=new Date(e.date),h=new Date(n.date);return y.direction==="ascending"?o-h:h-o}const s=e[y.key].toString().toLowerCase(),r=n[y.key].toString().toLowerCase();return s<r?y.direction==="ascending"?-1:1:s>r?y.direction==="ascending"?1:-1:0}),K=e=>{let n="ascending";y.key===e&&y.direction==="ascending"&&(n="descending"),te({key:e,direction:n})},U=e=>y.key!==e?null:t("span",{className:"ml-1",children:y.direction==="ascending"?"▲":"▼"}),I=(e,n)=>{const s=parseFloat(e)||0,r=parseFloat(n)||0;return(s*r).toFixed(2)},R=e=>{if(!e)return!1;const n=new Date(e);return n.getMonth()+1!==w.getMonth()+1||n.getFullYear()!==w.getFullYear()},H=()=>{if(a){u("Mode consultation uniquement. Vous ne pouvez pas ajouter de lignes.","warning");return}S(e=>[...e,V()])},se=async e=>{if(a){u("Mode consultation uniquement. Vous ne pouvez pas supprimer de lignes.","warning");return}const n=b.find(s=>s.id===e);if(n){if(b.length<=1){u("Impossible de supprimer la seule ligne","warning");return}if(!n.isNew&&n.originalId){if(!confirm("Êtes-vous sûr de vouloir supprimer cette ligne?"))return;M(s=>({...s,[e]:!0}));try{$.post(route("bml.delete"),{id:n.originalId,restaurant_id:d.id},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:s=>{console.error("Delete error:",s),u("Erreur lors de la suppression","error"),M(r=>({...r,[e]:!1}))}})}catch(s){u("Erreur lors de la suppression","error"),console.error("Error deleting row:",s),M(r=>({...r,[e]:!1}))}}else S(s=>s.filter(r=>r.id!==e)),M(s=>{const r={...s};return delete r[e],r})}},J=async e=>{if(a){u("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const n=b.find(s=>s.id===e);if(n){if(!n.date||!n.fournisseur||!n.designation||!n.quantity||!n.price||!n.unite){u("Veuillez remplir tous les champs obligatoires.","error");return}if(R(n.date)){const r=new Date(n.date).toLocaleDateString("fr-FR");if(!confirm(`Attention: La date sélectionnée (${r}) est en dehors du mois actuel. Cette entrée sera automatiquement placée dans le mois correspondant à sa date. Voulez-vous continuer?`))return}S(s=>s.map(r=>r.id===e?{...r,isSaving:!0}:r)),M(s=>({...s,[e]:!0}));try{const s=new Date(n.date),r={...n,date:_(s),type:c||n.type||"gastro",total_ttc:I(n.quantity,n.price)},o={restaurant_id:d.id,rows:[r],month:s.getMonth()+1,year:s.getFullYear(),type:c||"gastro",day_total:parseFloat(r.total_ttc).toFixed(2)};await $.post(route("bml.update-value"),o,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:h=>{console.error("Save error:",h),u("Erreur lors de l'enregistrement","error"),S(A=>A.map(O=>O.id===e?{...O,isSaving:!1}:O)),M(A=>({...A,[e]:!1}))}})}catch(s){console.error("Error saving row:",s),u("Erreur lors de l'enregistrement","error"),S(r=>r.map(o=>o.id===e?{...o,isSaving:!1}:o)),M(r=>({...r,[e]:!1}))}}},F=(e,n,s)=>{a||S(r=>r.map(o=>{if(o.id===e){const h={...o,[n]:s,hasChanges:!0};return n==="type"&&(h.fournisseur=B(s)),(n==="quantity"||n==="price")&&(h.total_ttc=I(n==="quantity"?s:o.quantity,n==="price"?s:o.price)),h}return o}))},ae=e=>{if(a){u("Mode consultation uniquement. Vous ne pouvez pas changer le type.","warning");return}try{const n=e.target.value;if(console.log("Type changed to:",n),z&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))return;Z(n),C(!0);const s=n===""?null:n,r=route("bml.show",[d.slug]);console.log("Navigating to:",r,"with type:",s),$.get(r,{month:w.getMonth()+1,year:w.getFullYear(),type:s},{preserveScroll:!0,preserveState:!0,onSuccess:o=>{console.log("Navigation successful",o),C(!1)},onError:o=>{console.error("Navigation error:",o),C(!1),u("Erreur lors du chargement des données.","error")}})}catch(n){console.error("Error in handleTypeChange:",n),C(!1),u("Une erreur est survenue lors du changement de type.","error")}},oe=e=>{a&&u("Mode consultation uniquement. Vous pouvez consulter d'autres mois.","info"),!(z&&!confirm("Vous avez des modifications non enregistrées. Voulez-vous continuer sans enregistrer?"))&&(g(e),C(!0),$.get(route("bml.show",[d.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:c},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{C(!1)},onError:()=>{C(!1),u("Erreur lors du chargement des données.","error")}}))},X=()=>{const e=re(b);return Object.entries(e).map(([n,s])=>({date:n,total:s.total.toFixed(2)})).sort((n,s)=>n.date.localeCompare(s.date))},ie=e=>{if(e.preventDefault(),a){u("Mode consultation uniquement. Vous ne pouvez pas enregistrer de modifications.","warning");return}const n=b.filter(o=>o.hasChanges);if(n.length===0){u("Aucune modification à enregistrer.","info");return}if(!confirm(`Voulez-vous enregistrer ${n.length} ligne(s) modifiée(s)?`))return;const s=n.map(o=>{const h=new Date(o.date);return{...o,date:_(h),type:c||o.type||"gastro",total_ttc:I(o.quantity,o.price)}}),r={restaurant_id:d.id,rows:s,month:w.getMonth()+1,year:w.getFullYear(),type:c||"gastro",day_total:s.reduce((o,h)=>o+parseFloat(h.total_ttc),0).toFixed(2)};C(!0),$.post(route("bml.store"),r,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{},onError:o=>{console.error("Save error:",o),u("Erreur lors de l'enregistrement","error"),C(!1)}})},q=(e,n,s,r)=>{if(!a){if(e.key==="Enter"){e.preventDefault(),J(n);return}if(e.key==="Tab"&&!e.shiftKey){const o=["date","fournisseur","designation","quantity","unite","price"];o.indexOf(s)===o.length-1&&(e.preventDefault(),r===b.length-1&&H(),setTimeout(()=>{const O=r+1;if(O<b.length){const le=b[O].id,Q=document.querySelector(`input[name="date-${le}"]`);Q&&Q.focus()}},0))}}};return i("div",{className:"p-4 sm:p-6",children:[a&&t("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg mb-4 p-3",children:i("div",{className:"flex items-center justify-center",children:[t(W,{className:"h-5 w-5 text-yellow-600 mr-2"}),t("span",{className:"font-medium text-yellow-800",children:"Mode consultation uniquement. Vous ne pouvez pas modifier les données."})]})}),t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[d.name," -"," ",w.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),t("div",{className:"relative",children:i("select",{value:c,onChange:ae,className:`block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 py-2 pl-3 pr-10 text-base ${a?"bg-gray-100 cursor-not-allowed":""}`,disabled:p||a,children:[t("option",{value:"",children:"Tous les types"}),Object.entries(k).map(([e,n])=>t("option",{value:n,children:e},n))]})})]}),t("div",{className:"flex-shrink-0",children:t(Te,{value:w,onChange:oe,disabled:p})})]})}),t("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:i("form",{onSubmit:ie,children:[p&&t("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i("div",{className:"text-center",children:[t("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),t("p",{className:"mt-2 text-gray-600",children:"Chargement en cours..."})]})}),t("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:i("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("date"),children:i("div",{className:"flex items-center",children:["Date ",U("date")]})}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0 cursor-pointer",onClick:()=>K("designation"),children:i("div",{className:"flex items-center",children:["Designation"," ",U("designation")]})}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 sticky top-0",children:"Actions"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[ne.map((e,n)=>{var s;return i("tr",{className:`hover:bg-gray-50 transition-colors duration-150 ${e.hasChanges?"bg-blue-50":""}`,children:[i("td",{className:`px-4 py-2 ${R(e.date)?"bg-yellow-50":""}`,children:[i("div",{className:"relative",children:[t("input",{name:`date-${e.id}`,type:"date",value:e.date||"",onChange:r=>F(e.id,"date",r.target.value),onKeyDown:r=>q(r,e.id,"date",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${R(e.date)?"border-yellow-400 bg-yellow-50":""} ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a,max:_(new Date)}),R(e.date)&&t("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:t("svg",{className:"h-5 w-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),R(e.date)&&t("div",{className:"text-xs text-yellow-600 mt-1",children:"Date hors du mois sélectionné"})]}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:e.fournisseur,onChange:r=>F(e.id,"fournisseur",r.target.value),onKeyDown:r=>q(r,e.id,"fournisseur",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:!0,readOnly:!0})}),i("td",{className:"px-4 py-2 relative",children:[t("input",{id:`designation-${e.id}`,type:"text",value:e.designation,onChange:r=>F(e.id,"designation",r.target.value),onKeyDown:r=>q(r,e.id,"designation",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a,autoComplete:"off",onFocus:()=>!a&&G(e.id),onBlur:()=>{setTimeout(()=>G(null),200)}}),!p&&!a&&ee===e.id&&i("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-md z-50 max-h-40 overflow-y-auto",children:[(s=j[c])==null?void 0:s.map((r,o)=>t("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onMouseDown:h=>{h.preventDefault(),F(e.id,"designation",r)},children:r},o)),(!j[c]||j[c].length===0)&&t("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Aucune suggestion"})]})]}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:e.quantity,onChange:r=>F(e.id,"quantity",r.target.value),onKeyDown:r=>q(r,e.id,"quantity",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:p||D[e.id]||a,readOnly:a})}),t("td",{className:"px-4 py-2",children:i("div",{className:"relative",children:[t("input",{type:"text",list:"unite-options",value:e.unite,onChange:r=>F(e.id,"unite",r.target.value),onKeyDown:r=>q(r,e.id,"unite",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,required:!0,disabled:p||D[e.id]||a,readOnly:a}),t("datalist",{id:"unite-options",children:Fe.map((r,o)=>t("option",{value:r},o))})]})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:e.price,onChange:r=>F(e.id,"price",r.target.value),onKeyDown:r=>q(r,e.id,"price",n),className:`w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-sm transition-colors duration-150 ${e.hasChanges?"border-blue-300":""} ${a?"bg-gray-100 cursor-not-allowed":""}`,min:"0",step:"0.01",required:!0,disabled:p||D[e.id]||a,readOnly:a})}),t("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900 font-medium",children:[parseFloat(e.total_ttc).toFixed(2)," ","MAD"]})}),t("td",{className:"px-4 py-2",children:i("div",{className:"flex space-x-2",children:[t("button",{type:"button",onClick:()=>J(e.id),className:`text-blue-600 hover:text-blue-800 ${!e.hasChanges||a?"opacity-50 cursor-not-allowed":""}`,disabled:p||!e.hasChanges||D[e.id]||a,title:a?"Mode consultation uniquement":"Enregistrer cette ligne",children:D[e.id]?t("div",{className:"h-5 w-5 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"}):t(xe,{className:"h-5 w-5"})}),t("button",{type:"button",onClick:()=>se(e.id),className:`text-red-600 hover:text-red-800 ${a||b.length<=1||D[e.id]?"opacity-50 cursor-not-allowed":""}`,disabled:p||b.length<=1||D[e.id]||a,title:a?"Mode consultation uniquement":"Supprimer cette ligne",children:t(we,{className:"h-5 w-5"})})]})})]},e.id)}),t("tr",{className:"bg-gray-50",children:i("td",{colSpan:"8",className:"px-4 py-3",children:[t("div",{className:"font-semibold text-gray-900 mb-2",children:"Totaux par jour"}),t("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:X().map(e=>i("div",{className:"flex justify-between items-center bg-white p-2 rounded-md shadow-sm",children:[t("span",{className:"text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),i("span",{className:"font-medium text-gray-900",children:[parseFloat(e.total).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]},e.date))}),i("div",{className:"mt-3 flex justify-end items-center border-t pt-2",children:[t("span",{className:"text-sm font-medium text-gray-600 mr-2",children:"Total du mois:"}),i("span",{className:"text-lg font-bold text-gray-900",children:[X().reduce((e,n)=>e+parseFloat(n.total),0).toLocaleString("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2})," ","MAD"]})]})]})})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:H,className:`inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 ${p||a?"opacity-50 cursor-not-allowed":""}`,disabled:p||a,title:a?"Mode consultation uniquement":"Ajouter une ligne",children:[t(be,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${!z||a||p?"opacity-50 cursor-not-allowed":""}`,disabled:p||!z||a,title:a?"Mode consultation uniquement":"Enregistrer toutes les modifications",children:p?"Enregistrement...":"Enregistrer tout"})]})]})}),t(Se,{toasts:E,removeToast:L})]})}export{$e as default};
