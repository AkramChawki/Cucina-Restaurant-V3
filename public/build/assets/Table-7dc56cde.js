import{q as z,W as A,r as d,j as e,F as V,a as n,d as q,f as X}from"./app-c2b6fd87.js";import{$ as x,_ as D,X as G,M as H,S as J,i as y}from"./SearchIcon-037f0cc6.js";import"./description-40d2a9bc.js";const K=[{name:"Se Déconnecter",href:"logout"}];function C(...h){return h.filter(Boolean).join(" ")}function I({categories:h,ficheId:m,restau:j,requiresRest:R}){const u=m==6?!0:R,{auth:P}=z().props,{data:o,setData:g}=A({name:P.user.name,restau:j||"",ficheId:m,products:h.reduce((t,a)=>(a.products.forEach(l=>{t.push({id:l.id,qty:"",rest:u?"":null})}),t),[])}),[$,b]=d.useState(!1),[F,W]=d.useState(""),[N,S]=d.useState(!1),L=t=>{t.target.blur()},v=t=>{(t.type==="touchstart"||t.type==="wheel")&&t.target.blur()},O=(t,a)=>{if(!a)return t;const l=parseFloat(t);if(l<=a)return a;const c=Math.ceil(l/a);return a*c},Q=(t,a)=>{if(a===""){const s=o.products.map(r=>r.id===t?{...r,qty:""}:r);g("products",s);return}const l=parseFloat(a);if(isNaN(l)||l<0)return;if(u){const s=o.products.find(r=>r.id===t);if(!s||s.rest===""||s.rest===void 0)return}const c=o.products.map(s=>s.id===t?{...s,qty:a}:s);g("products",c)},B=(t,a)=>{if(a===""){const s=o.products.map(r=>r.id===t?{...r,rest:""}:r);g("products",s);return}const l=parseFloat(a);if(isNaN(l)||l<0)return;const c=o.products.map(s=>s.id===t?{...s,rest:a}:s);g("products",c)},M=t=>{W(t.target.value.toLowerCase())},k=h.map(t=>{const a=t.products.filter(l=>l.designation.toLowerCase().includes(F));return{...t,products:a}}).filter(t=>t.products.length>0),T=k.map(t=>({name:t.name,href:`#${t.name.toLowerCase()}`})),E=async t=>{t.preventDefault(),S(!0);const a=o.products.filter(s=>{const r=parseFloat(s.qty);return!isNaN(r)&&r>0}).map(s=>{let r=null;for(const i of h){const w=i.products.find(_=>_.id===s.id);if(w&&w.cr){r=w.cr;break}}const f=parseFloat(s.qty);let p=f;return r&&(p=O(f,r)),{product_id:s.id,qty:p,...u&&{rest:parseFloat(s.rest)}}}),l={...o,products:a};let c=m>=26&&m<=33?"/commande-cuisinier/labo":m==6?"/BL/commander":"/commande-cuisinier/commander";try{await X.post(c,l)}catch{S(!1)}};return e(V,{children:n("div",{className:"min-h-screen bg-gray-50",children:[e(x.Root,{show:$,as:d.Fragment,children:n(D,{as:"div",className:"fixed inset-0 flex z-40 md:hidden",onClose:b,children:[e(x.Child,{as:d.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e(D.Overlay,{className:"fixed inset-0 bg-gray-600 bg-opacity-75"})}),e(x.Child,{as:d.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"-translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"-translate-x-full",children:n("div",{className:"relative flex-1 flex flex-col max-w-xs w-full pt-5 pb-4 bg-[#0D3D33]",children:[e(x.Child,{as:d.Fragment,enter:"ease-in-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in-out duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:n("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>b(!1),children:[e("span",{className:"sr-only",children:"Close sidebar"}),e(G,{className:"h-6 w-6 text-white","aria-hidden":"true"})]})})}),e("div",{className:"flex-shrink-0 flex items-center px-4",children:e("img",{className:"h-8 w-20",src:"/images/logo/Cucina.png",alt:"Workflow"})}),e("div",{className:"mt-5 flex-1 h-0 overflow-y-auto",children:e("nav",{className:"px-2 space-y-1",children:T.map(t=>e("a",{href:t.href,className:C("text-[#90D88C] hover:bg-[#73ac70]","group flex items-center px-2 py-2 text-base font-medium rounded-md"),children:t.name},t.name))})})]})})]})}),e("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0",children:n("div",{className:"flex flex-col flex-grow pt-5 bg-[#0D3D33] overflow-y-auto",children:[e("div",{className:"flex items-center flex-shrink-0 px-4",children:e("img",{className:"h-16 w-auto mx-auto",src:"/images/logo/Cucina.png",alt:"Workflow"})}),e("div",{className:"mt-5 flex-1 flex flex-col",children:e("nav",{className:"flex-1 px-2 pb-4 space-y-1",children:T.map(t=>e("a",{href:t.href,className:C("text-[#90D88C] hover:bg-[#73ac70]","group flex items-center px-2 py-2 text-sm font-medium rounded-md"),children:t.name},t.name))})})]})}),e("div",{className:"md:pl-64 flex flex-col flex-1",children:n("form",{onSubmit:E,children:[n("div",{className:"sticky top-0 z-10 flex-shrink-0 flex h-16 bg-white shadow",children:[n("button",{type:"button",className:"px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#90D88C] md:hidden",onClick:()=>b(!0),children:[e("span",{className:"sr-only",children:"Open sidebar"}),e(H,{className:"h-6 w-6","aria-hidden":"true"})]}),n("div",{className:"flex-1 px-4 flex justify-between",children:[e("div",{className:"flex-1 flex",children:n("div",{className:"w-full flex md:ml-0",children:[e("label",{htmlFor:"search-field",className:"sr-only",children:"Search"}),n("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:[e("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:e(J,{className:"h-5 w-5","aria-hidden":"true"})}),e("input",{id:"search-field",className:"block w-full h-full pl-8 pr-3 py-2 border-transparent text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-0 focus:border-transparent sm:text-sm",placeholder:"Search",type:"text",name:"search",value:F,onChange:M})]})]})}),e("div",{className:"ml-4 flex items-center md:ml-6",children:n(y,{as:"div",className:"ml-3 relative",children:[e("div",{children:n(y.Button,{className:"max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#90D88C]",children:[e("span",{className:"sr-only",children:"Open user menu"}),e("img",{className:"h-8 w-8 rounded-full",src:"https://cdn-icons-png.flaticon.com/512/1077/1077114.png",alt:""})]})}),e(x,{as:d.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e(y.Items,{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none",children:K.map(t=>e(y.Item,{children:({active:a})=>e(q,{href:route(t.href),method:"post",className:C(a?"bg-gray-100":"","block px-4 py-2 text-sm text-gray-700"),children:t.name})},t.name))})})]})})]})]}),e("main",{className:"flex-1",children:n("div",{className:"py-6 pb-32",children:[k.map(t=>n("div",{className:"px-4",children:[e("div",{className:"max-w-7xl mx-auto",children:n("div",{className:"flex items-center justify-between mb-4",children:[e("h1",{id:t.name.toLowerCase(),className:"text-2xl font-bold text-gray-900",children:t.name}),e("span",{className:"text-sm text-gray-500",children:t.products.length})]})}),e("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:t.products.map(a=>{var l,c,s,r,f,p;return n("div",{className:"bg-white rounded-lg overflow-hidden shadow",children:[e("div",{className:"aspect-w-1 aspect-h-1",children:e("img",{className:"w-full h-48 object-cover",src:"https://admin.cucinanapoli.com/storage/"+a.image,alt:a.designation})}),a.moy&&!(m>=26&&m<=33)&&n("div",{className:"bg-red-600 text-white py-2 text-center",children:["Moyenne : ",a.moy]}),n("div",{className:"p-4",children:[e("h3",{className:"text-lg font-semibold text-center mb-4",children:a.designation}),n("div",{className:"space-y-3",children:[u&&n("div",{children:[e("label",{className:"block text-sm text-gray-600 text-center mb-1",children:"Rest"}),e("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-center",placeholder:"Rest",min:"0",value:((l=o.products.find(i=>i.id===a.id))==null?void 0:l.rest)??"",onChange:i=>B(a.id,i.target.value),onWheel:L,onTouchStart:v,step:"any"})]}),n("div",{children:[e("label",{className:"block text-sm text-gray-600 text-center mb-1",children:"Quantité"}),e("input",{type:"number",className:`w-full px-3 py-2 border border-gray-300 rounded-md text-center ${u&&(((c=o.products.find(i=>i.id===a.id))==null?void 0:c.rest)===""||((s=o.products.find(i=>i.id===a.id))==null?void 0:s.rest)===void 0)?"bg-gray-100 cursor-not-allowed":""}`,placeholder:"0",min:"0",value:((r=o.products.find(i=>i.id===a.id))==null?void 0:r.qty)??"",onChange:i=>Q(a.id,i.target.value),onWheel:v,onTouchStart:v,disabled:u&&(((f=o.products.find(i=>i.id===a.id))==null?void 0:f.rest)===""||((p=o.products.find(i=>i.id===a.id))==null?void 0:p.rest)===void 0)}),n("div",{className:"text-center text-sm text-gray-500 mt-1",children:["unité (",a.unite,")"]}),a.cr&&n("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Conditionnement requis: ",a.cr]})]})]})]})]},`p-${a.id}`)})})]},`c-${t.id}`)),e("div",{className:"fixed bottom-0 left-0 right-0 bg-white shadow-lg p-4",style:{marginBottom:"20px"},children:e("div",{className:"max-w-7xl mx-auto flex flex-col space-y-2",children:n("div",{className:"flex flex-row space-x-4",children:[e("button",{type:"submit",disabled:N,className:`flex-1 ${N?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white py-3 rounded-lg font-semibold transition-colors`,children:N?"En cours...":"Commander"}),e(q,{href:"/",className:"flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors text-center",children:"Annuler"})]})})})]})})]})})]})})}export{I as default};
