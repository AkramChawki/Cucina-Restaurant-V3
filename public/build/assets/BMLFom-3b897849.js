import{j as t,i as O,r as N,a as i,f as D}from"./app-8abaef95.js";import{c as w}from"./createLucideIcon-7e7c2945.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],P=w("CircleAlert",Y);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],G=w("CircleCheckBig",z);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],U=w("CirclePlus",I);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],X=w("Trash2",V);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Q=w("X",H),J=({message:o,type:c="success",onClose:r})=>(N.useEffect(()=>{const u=setTimeout(()=>{r()},3e3);return()=>clearTimeout(u)},[r]),i("div",{className:`fixed top-4 right-4 flex items-center p-4 mb-4 rounded-lg shadow-lg ${c==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[t("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8",children:c==="success"?t(G,{className:"w-5 h-5 text-green-600"}):t(P,{className:"w-5 h-5 text-red-600"})}),t("div",{className:"ml-3 text-sm font-normal",children:o}),t("button",{onClick:r,className:"ml-4 -mx-1.5 -my-1.5 bg-transparent text-gray-400 hover:text-gray-900 rounded-lg p-1.5 inline-flex h-8 w-8",children:t(Q,{className:"w-5 h-5"})})]})),K=({toasts:o,removeToast:c})=>t("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-4",children:o.map(r=>t(J,{message:r.message,type:r.type,onClose:()=>c(r.id)},r.id))}),W=()=>{const[o,c]=O.useState([]);return{toasts:o,addToast:(d,y="success")=>{const x=Date.now();c(T=>[...T,{id:x,message:d,type:y}])},removeToast:d=>{c(y=>y.filter(x=>x.id!==d))}}},Z={Gastro:"gastro",Giada:"giada",Legume:"legume",Boisson:"boisson"},v=o=>{if(!o)return"";try{const c=o instanceof Date?o:new Date(o),r=c.getTimezoneOffset()*6e4;return new Date(c.getTime()-r).toISOString().split("T")[0]}catch(c){return console.error("Error formatting date:",c),""}},q=o=>o.reduce((r,u)=>{const d=u.date;return r[d]||(r[d]={rows:[],total:0}),r[d].rows.push(u),r[d].total+=parseFloat(u.total_ttc)||0,r},{});function se({restaurant:o,currentMonth:c,existingEntries:r=[],types:u=Z,currentType:d=""}){const{toasts:y,addToast:x,removeToast:T}=W(),[m,S]=N.useState(new Date(c.year,c.month-1)),[p,M]=N.useState(d),k=()=>({id:Date.now(),fournisseur:"",designation:"",quantity:"",price:"",unite:"",date:v(new Date),type:p,total_ttc:0}),[C,g]=N.useState([k()]);N.useEffect(()=>{if(r&&r.length>0){const s=r.map((e,n)=>({id:Date.now()+n,fournisseur:e.fournisseur||"",designation:e.designation||"",quantity:e.quantity||"",price:e.price||"",unite:e.unite||"",date:v(e.date),type:e.type||p,total_ttc:e.total_ttc||0}));g(s)}},[r,p]);const _=(s,e)=>{const n=parseFloat(s)||0,l=parseFloat(e)||0;return(n*l).toFixed(2)},F=()=>{g(s=>[...s,k()])},j=s=>{g(e=>e.length<=1?e:e.filter(n=>n.id!==s))},f=(s,e,n)=>{g(l=>l.map(a=>{if(a.id===s){const h={...a,[e]:n};return(e==="quantity"||e==="price")&&(h.total_ttc=_(e==="quantity"?n:a.quantity,e==="price"?n:a.price)),h}return a}))},L=s=>{const e=s.target.value;M(e),g([k()]),D.get(route("bml.show",[o.slug]),{month:m.getMonth()+1,year:m.getFullYear(),type:e},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{if(n.props.existingEntries.length>0){const l=n.props.existingEntries.map((a,h)=>({id:Date.now()+h,fournisseur:a.fournisseur||"",designation:a.designation||"",quantity:a.quantity||"",price:a.price||"",unite:a.unite||"",date:v(a.date||new Date),type:a.type||e,total_ttc:a.total_ttc||0}));g(l)}}})},R=s=>{const e=new Date(s.target.value);S(e),g([k()]),D.get(route("bml.show",[o.slug]),{month:e.getMonth()+1,year:e.getFullYear(),type:p},{preserveScroll:!0,preserveState:!0,onSuccess:n=>{if(n.props.existingEntries.length>0){const l=n.props.existingEntries.map((a,h)=>({id:Date.now()+h,fournisseur:a.fournisseur||"",designation:a.designation||"",quantity:a.quantity||"",price:a.price||"",unite:a.unite||"",date:v(a.date||new Date),type:a.type||p,total_ttc:a.total_ttc||0}));g(l)}}})},A=()=>{const s=q(C);return Object.entries(s).map(([n,l])=>({date:n,total:l.total.toFixed(2)})).sort((n,l)=>n.date.localeCompare(l.date))},E=s=>{s.preventDefault();const e=q(C),n=Object.entries(e).map(([l,a])=>{const h=a.rows,B=a.total.toFixed(2),$={restaurant_id:o.id,rows:h.map(b=>({...b,date:v(b.date),type:p||b.type,total_ttc:_(b.quantity,b.price)})),month:m.getMonth()+1,year:m.getFullYear(),type:p,day_total:B};return D.post(route("bml.update-value"),$)});Promise.all(n).then(()=>{x("Les données ont été enregistrées avec succès.","success"),D.get(route("bml.show",[o.slug]),{month:m.getMonth()+1,year:m.getFullYear(),type:p},{preserveScroll:!0,preserveState:!0})}).catch(l=>{x("Une erreur est survenue lors de l'enregistrement.","error"),console.error("Submission errors:",l)})};return i("div",{className:"p-4 sm:p-6",children:[t("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:i("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i("div",{className:"flex-1 flex items-center gap-4",children:[i("div",{children:[t("h2",{className:"text-lg font-semibold text-gray-900",children:"BML"}),i("p",{className:"mt-1 text-sm text-gray-600",children:[o.name," - ",m.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),i("select",{value:p,onChange:L,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[t("option",{value:"",children:"Tous les types"}),Object.entries(u).map(([s,e])=>t("option",{value:e,children:s},e))]})]}),t("div",{className:"flex-shrink-0",children:t("input",{type:"month",value:`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,onChange:R,className:"block w-full sm:w-auto border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})})]})}),t("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:i("form",{onSubmit:E,children:[t("div",{className:"overflow-x-auto",children:i("table",{className:"min-w-full divide-y divide-gray-200",children:[t("thead",{className:"bg-gray-50",children:i("tr",{children:[t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Designation"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unité"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total TTC"}),t("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),i("tbody",{className:"bg-white divide-y divide-gray-200",children:[C.map(s=>i("tr",{children:[t("td",{className:"px-4 py-2",children:t("input",{type:"date",value:s.date||"",onChange:e=>f(s.id,"date",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.fournisseur,onChange:e=>f(s.id,"fournisseur",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.designation,onChange:e=>f(s.id,"designation",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.quantity,onChange:e=>f(s.id,"quantity",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"text",value:s.unite,onChange:e=>f(s.id,"unite",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",required:!0})}),t("td",{className:"px-4 py-2",children:t("input",{type:"number",value:s.price,onChange:e=>f(s.id,"price",e.target.value),className:"w-full border-gray-300 rounded-sm focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"0.01",required:!0})}),t("td",{className:"px-4 py-2",children:i("div",{className:"text-sm text-gray-900",children:[s.total_ttc,"MAD"]})}),t("td",{className:"px-4 py-2",children:t("button",{type:"button",onClick:()=>j(s.id),className:"text-red-600 hover:text-red-800",children:t(X,{className:"h-5 w-5"})})})]},s.id)),i("tr",{className:"bg-gray-50 font-semibold",children:[t("td",{colSpan:"6",className:"px-4 py-2 text-right",children:"Totaux par jour"}),t("td",{className:"px-4 py-2 text-gray-900",children:A().map((s,e)=>i("div",{children:[new Date(s.date).toLocaleDateString("fr-FR"),": ",s.total,"MAD"]},s.date))}),t("td",{})]})]})]})}),i("div",{className:"p-4 flex justify-between items-center bg-gray-50",children:[i("button",{type:"button",onClick:F,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[t(U,{className:"h-4 w-4 mr-2"}),"Ajouter une ligne"]}),t("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Enregistrer"})]})]})}),t(K,{toasts:y,removeToast:T})]})}export{se as default};
