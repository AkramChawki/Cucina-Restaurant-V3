import{q as J,r as F,a as n,j as r,f as M}from"./app-09bff3f3.js";function K({title:A,routeName:C,restaurant:b,products:g,currentMonth:S}){const{auth:h,processing:T}=J().props,d=h.user.guest===1,z=typeof h.user.role=="string"?JSON.parse(h.user.role):Array.isArray(h.user.role)?h.user.role:[],u=!d&&H(z),x=!d&&Y(z);function H(e){const t=["Cost-Cuisine","Cost-Pizza","Cost-Economat","Cost-Consomable"];return e.some(a=>t.includes(a))}function Y(e){const t=["Audit","Admin","Analytics"];return e.some(a=>t.includes(a))}const[o,P]=F.useState(new Date(S.year,S.month-1)),[c,q]=F.useState(null),[O,y]=F.useState(!1),v=Array.from({length:new Date(o.getFullYear(),o.getMonth()+1,0).getDate()},(e,t)=>t+1),W=e=>{const t=new Date(e.target.value);P(t),M.get(window.location.pathname,{month:t.getMonth()+1,year:t.getFullYear()},{preserveState:!0,preserveScroll:!0,only:["products","currentMonth"]})},p=(e,t)=>{const a=parseFloat(l(e,t,"morning"))||0,i=parseFloat(l(e,t,"afternoon"))||0;return(a+i)*(e.prix||0)},w=e=>g.reduce((t,a)=>t+p(a,e),0),B=()=>v.reduce((e,t)=>e+w(t),0),L=e=>v.reduce((t,a)=>{const i=parseFloat(l(e,a,"morning"))||0,s=parseFloat(l(e,a,"afternoon"))||0;return t+i+s},0),V=(e,t,a,i)=>{if(d)return;if(!k(e,t)){alert("You don't have permission to edit this entry.");return}const s=a==="morning"?parseFloat(i)||0:parseFloat(l(e,t,"morning"))||0,m=a==="afternoon"?parseFloat(i)||0:parseFloat(l(e,t,"afternoon"))||0,$=(s+m)*(e.prix||0);let f={...e.values||{}};f[t]||(f[t]={morning:0,afternoon:0,total:0,status:"pending"}),f[t]={morning:s,afternoon:m,total:$,status:f[t].status||"pending"};let D=0;g.forEach(_=>{_.id===e.id?D+=$:D+=p(_,t)}),M.post(route(C),{restaurant_id:b.id,product_id:e.id,day:t,month:o.getMonth()+1,year:o.getFullYear(),period:a,value:i||0,daily_data:f[t],day_total:D},{preserveScroll:!0,preserveState:!0})},G=e=>{d||(q(e),y(!0))},I=()=>{d||!c||(g.forEach(e=>{j(e,c)&&M.post(route(C),{restaurant_id:b.id,product_id:e.id,day:c,month:o.getMonth()+1,year:o.getFullYear(),period:"morning",value:l(e,c,"morning"),daily_data:{morning:parseFloat(l(e,c,"morning"))||0,afternoon:parseFloat(l(e,c,"afternoon"))||0,total:p(e,c),status:"verified"},day_total:w(c),verify:!0},{preserveScroll:!0,preserveState:!0})}),y(!1))},j=(e,t)=>e.values&&e.values[t]&&(parseFloat(e.values[t].morning)>0||parseFloat(e.values[t].afternoon)>0),k=(e,t)=>{if(d)return!1;if(x)return!0;if(u){if(!e.values||!e.values[t])return!0;const a=e.values[t].status||"pending",i=e.values[t].created_at;if(a==="pending"&&i){const s=new Date().toDateString(),m=new Date(i).toDateString();return s===m}return!1}return!1},E=(e,t)=>e.values&&e.values[t]&&e.values[t].status==="verified",N=e=>g.every(t=>!j(t,e)||E(t,e)),R=e=>{e.target.blur()},l=(e,t,a)=>!e.values||!e.values[t]?"":e.values[t][a]||"";return n("div",{className:"flex flex-col h-full",children:[T&&r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white p-4 rounded-lg",children:"Loading..."})}),(u||x)&&r("div",{className:`${u?"bg-blue-50 border-blue-200":"bg-green-50 border-green-200"} border-b p-3`,children:n("div",{className:"flex items-center justify-center",children:[r("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ${u?"text-blue-600":"text-green-600"} mr-2`,viewBox:"0 0 20 20",fill:"currentColor",children:r("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),r("span",{className:`font-medium ${u?"text-blue-800":"text-green-800"}`,children:u?"Mode saisie. Vous pouvez ajouter de nouvelles données ou modifier vos saisies du jour.":"Mode vérification. Vous pouvez vérifier et modifier toutes les entrées."})]})}),d&&r("div",{className:"bg-yellow-50 border-b border-yellow-200 p-3",children:n("div",{className:"flex items-center justify-center",children:[r("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-600 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:r("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),r("span",{className:"font-medium text-yellow-800",children:"Mode consultation uniquement. Vous ne pouvez pas modifier les données."})]})}),n("div",{className:"bg-white p-4 border-b shadow-sm",children:[n("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 max-w-7xl mx-auto",children:[n("div",{children:[r("h1",{className:"text-xl font-semibold text-gray-900",children:A}),n("p",{className:"text-sm text-gray-600",children:[b.name," - ",o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),r("input",{type:"month",value:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,onChange:W,className:"border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500'}"})]}),r("div",{className:"mt-4 flex justify-center",children:n("div",{className:"bg-green-50 border border-green-200 rounded-lg px-6 py-3 shadow-sm",children:[r("h2",{className:"text-sm font-medium text-green-700 text-center",children:"Total du Mois"}),n("p",{className:"text-2xl font-bold text-green-800 text-center",children:[B().toFixed(2),"DH"]})]})})]}),r("div",{className:"sm:hidden bg-blue-50 p-2 text-center text-xs text-blue-700",children:"Swipe horizontally to see more days →"}),r("div",{className:"flex-1 overflow-hidden",children:r("div",{className:"h-full overflow-y-auto",children:r("div",{className:"overflow-x-auto pb-4 min-w-full",children:n("table",{className:"w-full border-collapse min-w-max",children:[r("thead",{className:"bg-gray-50 sticky top-0 z-20",children:n("tr",{children:[r("th",{className:"sticky left-0 z-30 bg-gray-50 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider max-w-[130px] sm:max-w-none px-2 sm:px-6",children:"Produit"}),v.map(e=>n("th",{className:"px-3 py-3 text-center border-x min-w-[90px]",children:[n("div",{className:"flex justify-between items-center mb-1",children:[r("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:e}),x&&r("button",{onClick:()=>G(e),className:`px-2 py-0.5 rounded text-xs ${N(e)?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:N(e)?"Vérifié":"Vérifier"}),!x&&N(e)&&r("span",{className:"px-2 py-0.5 rounded text-xs bg-green-100 text-green-800",children:"Vérifié"})]}),n("div",{className:"text-sm font-semibold text-green-600",children:[w(e).toFixed(2),"DH"]}),n("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[r("div",{className:"text-xs text-gray-500",children:"Matin"}),r("div",{className:"text-xs text-gray-500",children:"Midi"})]})]},e))]})}),r("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>n("tr",{className:"hover:bg-gray-50",children:[r("td",{className:"sticky left-0 bg-white border-r whitespace-nowrap z-20 hover:bg-gray-50 max-w-[140px] sm:max-w-none px-2 sm:px-6 py-2 sm:py-4",children:n("div",{className:"flex items-center gap-1 sm:gap-3",children:[r("img",{src:`https://admin.cucinanapoli.com/storage/${e.image}`,alt:e.designation,className:"h-8 w-8 sm:h-12 sm:w-12 object-cover rounded-md flex-shrink-0"}),n("div",{className:"flex flex-col min-w-0",children:[r("span",{className:"text-sm font-medium text-gray-900 truncate",children:e.designation}),n("span",{className:"text-xs text-gray-500 truncate",children:[e.prix,"DH/",e.unite]}),n("div",{className:"mt-1 text-green-700 text-xs px-2 py-1 rounded-md inline-flex items-center",children:[r("span",{className:"font-semibold",children:"Total: "}),r("span",{className:"ml-1",children:L(e).toFixed(2)})]})]})]})}),v.map(t=>{const a=E(e,t),s=!k(e,t)||d;return r("td",{className:`px-1 py-2 border-x min-w-[90px] ${a?"bg-green-50":""}`,children:n("div",{className:"flex flex-col gap-1",children:[n("div",{className:"grid grid-cols-2 gap-1",children:[r("input",{type:"number",className:`w-full border-${a?"green":"gray"}-300 rounded-sm ${s?"bg-gray-100 cursor-not-allowed":"focus:ring-green-500 focus:border-green-500"} text-sm p-1`,value:l(e,t,"morning"),onChange:m=>V(e,t,"morning",m.target.value),onWheel:R,step:"0.01",min:"0",placeholder:"0",disabled:s,readOnly:s}),r("input",{type:"number",className:`w-full border-${a?"green":"gray"}-300 rounded-sm ${s?"bg-gray-100 cursor-not-allowed":"focus:ring-green-500 focus:border-green-500"} text-sm p-1`,value:l(e,t,"afternoon"),onChange:m=>V(e,t,"afternoon",m.target.value),onWheel:R,step:"0.01",min:"0",placeholder:"0",disabled:s,readOnly:s})]}),n("div",{className:"text-xs text-right text-gray-600 pr-1",children:[p(e,t).toFixed(2),"DH"]})]})},t)})]},e.id))})]})})})}),O&&r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confirmer la vérification"}),n("p",{className:"text-gray-600 mb-6",children:["Êtes-vous sûr de vouloir vérifier les entrées pour le jour ",c," ? Cette action marquera toutes les entrées comme vérifiées."]}),n("div",{className:"flex justify-end gap-3",children:[r("button",{className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md",onClick:()=>y(!1),children:"Annuler"}),r("button",{className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-md",onClick:I,children:"Confirmer"})]})]})})]})}export{K as default};
